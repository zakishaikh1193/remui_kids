{{!
    Custom Dashboard Template for remui_kids theme
    
    This template provides different dashboard layouts based on user cohorts:
    - Elementary (Grades 1-3)
    - Middle School (Grades 4-7) 
    - High School (Grades 8-12)
    - Default (fallback)
}}

{{> theme_remui_kids/common_start}}

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

{{#custom_dashboard}}

<div class="custom_dashboard">



<!-- Cohort-specific content -->
{{#dashboard_type}}
    {{#elementary}}
        <!-- Student Sidebar -->
        <div class="student-sidebar">
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="{{{dashboardurl}}}" class="nav-link active">
                            <i class="fa fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{config.wwwroot}}/theme/remui_kids/my_courses.php" class="nav-link">
                            <i class="fa fa-book"></i>
                            <span>My Courses</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{gradesurl}}}" class="nav-link">
                            <i class="fa fa-chart-line"></i>
                            <span>My Grades</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{assignmentsurl}}}" class="nav-link">
                            <i class="fa fa-tasks"></i>
                            <span>Assignments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{messagesurl}}}" class="nav-link">
                            <i class="fa fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{codeeditorurl}}}" class="nav-link">
                            <i class="fa fa-code"></i>
                            <span>Code Editor</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{scratchurl}}}" class="nav-link">
                            <i class="fa fa-puzzle-piece"></i>
                            <span>Scratch Emulator</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{student_name}}</div>
                        <div class="user-role">Elementary Student</div>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <a href="{{{profileurl}}}" class="action-btn profile-btn">
                        <i class="fa fa-user-circle"></i>
                        <span>Profile</span>
                    </a>
                    <a href="{{{logouturl}}}" class="action-btn logout-btn">
                        <i class="fa fa-sign-out"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="elementary-dashboard">
            <!-- Grade 1-3 Statistics Cards -->
            {{#elementary_stats}}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="elementary-stats-container">
                        <!-- Total Courses Card -->
                        <div class="elementary-stat-card courses-card" id="courses-card">
                            <div class="stat-icon-container">
                                <i class="fa fa-book stat-icon"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="total-courses-count">{{total_courses}}</div>
                                <div class="stat-label">Courses</div>
                                <div class="stat-updated" id="courses-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                    Last updated: {{#elementary_stats}}{{#last_updated}}{{last_updated}}{{/last_updated}}{{/elementary_stats}}
                                </div>
                            </div>
                            <div class="stat-refresh-btn" onclick="refreshCourseCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; color: #666; font-size: 14px;" title="Refresh Course Count">
                                <i class="fa fa-refresh" id="courses-refresh-icon"></i>
                            </div>
                        </div>
                        
                        <!-- Lessons Completed Card -->
                        <div class="elementary-stat-card lessons-card">
                            <div class="stat-icon-container">
                                <i class="fa fa-check-circle stat-icon"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{lessons_completed}}</div>
                                <div class="stat-label">Lessons Done</div>
                            </div>
                        </div>
                        
                        <!-- Activities Completed Card -->
                        <div class="elementary-stat-card activities-card">
                            <div class="stat-icon-container">
                                <i class="fa fa-trophy stat-icon"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{activities_completed}}</div>
                                <div class="stat-label">Activities Done</div>
                            </div>
                        </div>
                        
                        <!-- Overall Progress Card -->
                        <div class="elementary-stat-card progress-card">
                            <div class="stat-icon-container">
                                <i class="fa fa-chart-line stat-icon"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">{{overall_progress}}%</div>
                                <div class="stat-label">Overall Progress</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{/elementary_stats}}

            <!-- My Courses Section -->
            {{#has_elementary_courses}}
            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="sections-section-title">
                        <i class="fa fa-book"></i> My Courses
                    </h3>
                    <div class="elementary-courses-container">
                        {{#elementary_courses}}
                        <div class="elementary-course-card enhanced" data-course-id="{{id}}">
                            <!-- Course Header with Image -->
                            <div class="course-image-container">
                                {{#courseimage}}
                                <img src="{{courseimage}}" alt="{{fullname}}" class="course-image">
                                {{/courseimage}}
                                {{^courseimage}}
                                <div class="course-image-placeholder">
                                    <i class="fa fa-book"></i>
                                </div>
                                {{/courseimage}}
                                
                                <!-- Course Level Badge -->
                                <div class="course-level-badge">{{categoryname}}</div>
                                
                                <!-- Course Status Indicator -->
                                <div class="course-status-indicator {{#completed}}completed{{/completed}}{{^completed}}{{#in_progress}}in-progress{{/in_progress}}{{^in_progress}}not-started{{/in_progress}}{{/completed}}">
                                    <i class="fa {{#completed}}fa-check-circle{{/completed}}{{^completed}}{{#in_progress}}fa-play-circle{{/in_progress}}{{^in_progress}}fa-circle-o{{/in_progress}}{{/completed}}"></i>
                                </div>
                            </div>
                            
                            <!-- Course Content -->
                            <div class="course-content">
                                <!-- Course Title and Grade -->
                                <div class="course-header">
                                    <h4 class="course-title">{{fullname}}</h4>
                                    <span class="course-grade">{{grade_level}}</span>
                                </div>
                                
                                <!-- Course Summary -->
                                <p class="course-summary">{{summary}}</p>
                                
                                <!-- Progress Section -->
                                <div class="course-progress-section">
                                    <div class="progress-header">
                                        <span class="progress-label">Your Progress</span>
                                        <span class="progress-percentage">{{progress_percentage}}%</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Course Statistics -->
                                <div class="course-stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fa fa-book"></i>
                                        </div>
                                        <div class="stat-info">
                                            <div class="stat-number">{{completed_sections}}/{{total_sections}}</div>
                                            <div class="stat-label">Lessons</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fa fa-tasks"></i>
                                        </div>
                                        <div class="stat-info">
                                            <div class="stat-number">{{completed_activities}}/{{total_activities}}</div>
                                            <div class="stat-label">Activities</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fa fa-clock-o"></i>
                                        </div>
                                        <div class="stat-info">
                                            <div class="stat-number">{{estimated_time}}</div>
                                            <div class="stat-label">Minutes</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-item">
                                        <div class="stat-icon">
                                            <i class="fa fa-star"></i>
                                        </div>
                                        <div class="stat-info">
                                            <div class="stat-number">{{points_earned}}</div>
                                            <div class="stat-label">Points</div>
                                        </div>
                                    </div>
                                </div>
                                                                
                                <!-- Course Actions -->
                                <div class="course-actions">
                                    {{#completed}}
                                    <a href="{{courseurl}}" class="course-button completed">
                                        <i class="fa fa-check"></i> Review Course
                                    </a>
                                    {{/completed}}
                                    {{^completed}}
                                    {{#in_progress}}
                                    <a href="{{courseurl}}" class="course-button in-progress">
                                        <i class="fa fa-play"></i> Continue Learning
                                    </a>
                                    {{/in_progress}}
                                    {{^in_progress}}
                                    <a href="{{courseurl}}" class="course-button not-started">
                                        <i class="fa fa-play"></i> Start Course
                                    </a>
                                    {{/in_progress}}
                                    {{/completed}}
                                    
                                    <!-- Course Details Button -->
                                    <button class="course-details-btn" onclick="toggleCourseDetails({{id}})">
                                        <i class="fa fa-info-circle"></i>
                                    </button>
                                </div>
                                
                                <!-- Course Details Panel (Hidden by default) -->
                                <div class="course-details-panel" id="details-{{id}}" style="display: none;">
                                    <div class="details-content">
                                        <h6>Course Details</h6>
                                        <div class="detail-item">
                                            <strong>Instructor:</strong> {{instructor_name}}
                                        </div>
                                        <div class="detail-item">
                                            <strong>Start Date:</strong> {{start_date}}
                                        </div>
                                        <div class="detail-item">
                                            <strong>Last Accessed:</strong> {{last_accessed}}
                                        </div>
                                        <div class="detail-item">
                                            <strong>Next Activity:</strong> {{next_activity}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{/elementary_courses}}
                    </div>
                    
                    <!-- View All Courses Button -->
                    {{#show_view_all_button}}
                    <div class="text-center mt-3">
                        <a href="{{config.wwwroot}}/theme/remui_kids/my_courses.php" class="btn btn-outline-primary view-all-courses-btn">
                            <i class="fa fa-th-large"></i> View All Courses ({{total_courses_count}})
                        </a>
                    </div>
                    {{/show_view_all_button}}
                </div>
            </div>
            {{/has_elementary_courses}}
            
            <!-- Active Lessons Section -->
            {{#has_elementary_active_sections}}
            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="sections-section-title">
                        <i class="fa fa-list-alt"></i> Active Lessons
                    </h3>
                    <div class="elementary-sections-container">
                        {{#elementary_active_sections}}
                        <div class="elementary-section-card">
                            <div class="section-content">
                                <div class="section-header">
                                    <h4 class="section-title">{{name}}</h4>
                                    <span class="section-course">{{coursename}}</span>
                                </div>
                                
                                {{#summary}}
                                <p class="section-summary">{{summary}}</p>
                                {{/summary}}
                                
                                <!-- Progress Bar -->
                                <div class="section-progress-section">
                                    <div class="progress-bar-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
                                        </div>
                                        <span class="progress-percentage">{{progress_percentage}}%</span>
                                    </div>
                                </div>
                                
                                <!-- Section Stats -->
                                <div class="section-stats">
                                    <div class="section-stat-item">
                                        <i class="fa fa-check-circle" style="color: #27ae60;"></i>
                                        <span>{{completed_activities}}/{{total_activities}} activities</span>
                                    </div>
                                </div>
                                
                                <a href="{{courseurl}}" class="section-button">
                                    <i class="fa fa-play"></i> Continue Section
                                </a>
                            </div>
                        </div>
                        {{/elementary_active_sections}}
                    </div>
                </div>
            </div>
            {{/has_elementary_active_sections}}
            
            <!-- Active Activities Section -->
            {{#has_elementary_active_lessons}}
            <div class="row mb-4">
                <div class="col-12">
                    <h3 class="lessons-section-title">
                        <i class="fa fa-gamepad"></i> Active Activities
                    </h3>
                    <div class="elementary-lessons-container">
                        {{#elementary_active_lessons}}
                        <a href="{{url}}" class="elementary-lesson-card" data-status="{{status}}">
                            <div class="lesson-icon-container" style="background-color: {{color}};">
                                <i class="fa {{icon}}"></i>
                            </div>
                            <div class="lesson-name">{{name}}</div>
                            <div class="lesson-course">{{coursename}}</div>
                            {{#description}}
                            <div class="lesson-description">{{description}}</div>
                            {{/description}}
                        </a>
                        {{/elementary_active_lessons}}
                    </div>
                </div>
            </div>
            {{/has_elementary_active_lessons}}
            
        </div>
    {{/elementary}}
    
    {{#middle}}
        <!-- Student Sidebar -->
        <div class="student-sidebar">
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="{{{dashboardurl}}}" class="nav-link active">
                            <i class="fa fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{mycoursesurl}}}" class="nav-link">
                            <i class="fa fa-book"></i>
                            <span>My Courses</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{gradesurl}}}" class="nav-link">
                            <i class="fa fa-star"></i>
                            <span>My Grades</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{assignmentsurl}}}" class="nav-link">
                            <i class="fa fa-tasks"></i>
                            <span>Assignments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{messagesurl}}}" class="nav-link">
                            <i class="fa fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{codeeditorurl}}}" class="nav-link">
                            <i class="fa fa-code"></i>
                            <span>Code Editor</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{scratchurl}}}" class="nav-link">
                            <i class="fa fa-puzzle-piece"></i>
                            <span>Scratch Emulator</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fa fa-user-circle"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{{fullname}}}</div>
                        <div class="user-role">Student</div>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <a href="{{{profileurl}}}" class="action-btn profile-btn">
                        <i class="fa fa-user-circle"></i>
                        <span>Profile</span>
                    </a>
                    <a href="{{{logouturl}}}" class="action-btn logout-btn">
                        <i class="fa fa-sign-out"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>
        
        <div class="middle-dashboard">
            <!-- Top Statistics Bar -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="middle-stats-container">
                        <div class="middle-stat-card" id="middle-courses-card">
                            <div class="stat-content">
                                <div class="stat-title">Active Courses</div>
                                <div class="stat-number" id="middle-total-courses-count">{{middle_stats.total_courses}}</div>
                                <div class="stat-subtext">2 in progress</div>
                                <div class="stat-trend">+12% this week</div>
                                <div class="stat-updated" id="middle-courses-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                    Last updated: {{#middle_stats}}{{#last_updated}}{{last_updated}}{{/last_updated}}{{/middle_stats}}
                                </div>
                            </div>
                            <div class="stat-icon-container blue">
                                <i class="fa fa-book"></i>
                            </div>
                            <div class="stat-refresh-btn" onclick="refreshMiddleCourseCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; color: #666; font-size: 14px;">
                                <i class="fa fa-refresh" id="middle-courses-refresh-icon"></i>
                            </div>
                        </div>
                        <div class="middle-stat-card">
                            <div class="stat-content">
                                <div class="stat-title">Lessons Completed</div>
                                <div class="stat-number">{{middle_stats.lessons_completed}}</div>
                                <div class="stat-subtext">this month</div>
                                <div class="stat-trend">+8% this week</div>
                            </div>
                            <div class="stat-icon-container green">
                                <i class="fa fa-bullseye"></i>
                            </div>
                        </div>
                        <div class="middle-stat-card">
                            <div class="stat-content">
                                <div class="stat-title">Study Time</div>
                                <div class="stat-number">24h</div>
                                <div class="stat-subtext">this week</div>
                                <div class="stat-trend">+5% this week</div>
                            </div>
                            <div class="stat-icon-container purple">
                                <i class="fa fa-clock-o"></i>
                            </div>
                        </div>
                        <div class="middle-stat-card">
                            <div class="stat-content">
                                <div class="stat-title">Achievements</div>
                                <div class="stat-number">12</div>
                                <div class="stat-subtext">total earned</div>
                                <div class="stat-trend">+3% this week</div>
                            </div>
                            <div class="stat-icon-container orange">
                                <i class="fa fa-trophy"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="row">
                <!-- Left Content Area -->
                <div class="col-lg-9">
                    <!-- Current Courses Section -->
                    {{#has_middle_courses}}
                    <div class="middle-courses-section">
                        <div class="section-header">
                            <h3 class="section-title">My Courses</h3>
                            <a href="{{{mycoursesurl}}}" class="view-all-link">View All ></a>
                        </div>
                        <div class="courses-static-grid">
                            {{#middle_courses}}
                            <div class="middle-course-card">
                                <div class="course-image-container">
                                    {{#courseimage}}
                                    <img src="{{courseimage}}" alt="{{fullname}}" class="course-image">
                                    {{/courseimage}}
                                    {{^courseimage}}
                                    <div class="course-image-placeholder">
                                        <i class="fa fa-book"></i>
                                    </div>
                                    {{/courseimage}}
                                    <div class="course-level-badge">Beginner</div>
                                </div>
                                
                                <div class="course-content">
                                    <h4 class="course-title">{{fullname}}</h4>
                                    <p class="course-summary">{{#summary}}{{summary}}{{/summary}}{{^summary}}No description available{{/summary}}</p>
                                    
                                    <!-- Progress Bar -->
                                    <div class="course-progress-section">
                                        <div class="progress-label">Progress {{progress_percentage}}%</div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Course Stats -->
                                    <div class="course-stats">
                                        <div class="course-stat-item">
                                            <span>{{total_sections}}/{{total_sections}} lessons</span>
                                        </div>
                                    <div class="course-status">not started</div>
                                    
                                    <div class="course-buttons">
                                        <a href="{{courseurl}}" class="course-button primary">
                                            <i class="fa fa-play"></i> Continue Learning
                                        </a>

                                                <button class="course-button secondary preview-btn" onclick="openPreviewModal({{id}}, '{{fullname}}')">
                                                    <i class="fa fa-eye"></i> Preview
                                                </button>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            {{/middle_courses}}
                        </div>
                        
                        <!-- My Courses Button -->
                        <div class="my-courses-button-container">
                            
                        </div>
                    </div>
                    {{/has_middle_courses}}
                    
                    <!-- Current Lessons Section (Active Sections) -->
                    {{#has_middle_active_sections}}
                    <div class="current-lessons-section">
                        <div class="section-header">
                            <h3 class="section-title">
                                <i class="fa fa-list-alt"></i> Current Lessons
                            </h3>
                            <p class="section-subtitle">Continue your learning journey</p>
                            <a href="#" class="view-all-link">View All ></a>
                        </div>
                        <div class="elementary-sections-container">
                            {{#middle_active_sections}}
                            <div class="elementary-section-card">
                                <div class="section-content">
                                    <div class="section-header">
                                        <h4 class="section-title">{{name}}</h4>
                                        <span class="section-course">{{coursename}}</span>
                                    </div>
                                    
                                    {{#summary}}
                                    <p class="section-summary">{{summary}}</p>
                                    {{/summary}}
                                    
                                    <!-- Progress Bar -->
                                    <div class="section-progress-section">
                                        <div class="progress-bar-container">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: {{progress_percentage}}%"></div>
                                </div>
                                            <span class="progress-percentage">{{progress_percentage}}%</span>
                                </div>
                            </div>
                                    
                                    <!-- Section Stats -->
                                    <div class="section-stats">
                                        <div class="section-stat-item">
                                            <i class="fa fa-check-circle" style="color: #27ae60;"></i>
                                            <span>{{completed_activities}}/{{total_activities}} activities</span>
                        </div>
                    </div>
                                    
                                    <a href="{{courseurl}}" class="section-button">
                                        <i class="fa fa-play"></i> Continue Section
                                    </a>
                                </div>
                            </div>
                            {{/middle_active_sections}}
                        </div>
                    </div>
                    {{/has_middle_active_sections}}
                    
                    <!-- My Achievements Section -->
                    <div class="achievements-section">
                        <div class="achievements-header">
                            <div class="header-content">
                                <h3 class="achievements-title">
                                <i class="fa fa-trophy"></i> My Achievements
                            </h3>
                                <p class="achievements-subtitle">Track your learning milestones</p>
                        </div>
                            <a href="#" class="view-all-achievements">
                                <span>View All Achievements</span>
                                <i class="fa fa-arrow-right"></i>
                            </a>
                                </div>
                        
                        <div class="achievements-container">
                            <div class="achievement-card earned">
                                <div class="achievement-icon">
                                    <i class="fa fa-book"></i>
                                </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Course Explorer</h4>
                                    <p class="achievement-description">Enrolled in 3 courses</p>
                            </div>
                                <div class="achievement-status">
                                    <i class="fa fa-check-circle"></i>
                                </div>
                                </div>
                            
                            <div class="achievement-card earned">
                                <div class="achievement-icon">
                                    <i class="fa fa-tasks"></i>
                            </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Activity Master</h4>
                                    <p class="achievement-description">Completed 12 activities</p>
                                </div>
                                <div class="achievement-status">
                                    <i class="fa fa-check-circle"></i>
                                </div>
                            </div>
                            
                            <div class="achievement-card earned">
                                <div class="achievement-icon">
                                    <i class="fa fa-calendar-check-o"></i>
                                </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Assignment Hero</h4>
                                    <p class="achievement-description">Submitted 5 assignments</p>
                                </div>
                                <div class="achievement-status">
                                    <i class="fa fa-check-circle"></i>
                                </div>
                            </div>
                            
                            <div class="achievement-card locked">
                                <div class="achievement-icon">
                                    <i class="fa fa-graduation-cap"></i>
                                </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Course Graduate</h4>
                                    <p class="achievement-description">Complete 1 full course</p>
                                </div>
                                <div class="achievement-status">
                                    <i class="fa fa-lock"></i>
                            </div>
                                </div>
                            
                            <div class="achievement-card locked">
                                <div class="achievement-icon">
                                    <i class="fa fa-comments"></i>
                                </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Forum Contributor</h4>
                                    <p class="achievement-description">Post 10 forum messages</p>
                            </div>
                                <div class="achievement-status">
                                    <i class="fa fa-lock"></i>
                                </div>
                                </div>
                            
                            <div class="achievement-card locked">
                                <div class="achievement-icon">
                                    <i class="fa fa-certificate"></i>
                            </div>
                                <div class="achievement-content">
                                    <h4 class="achievement-title">Certification Seeker</h4>
                                    <p class="achievement-description">Earn 1 certificate</p>
                                </div>
                                <div class="achievement-status">
                                    <i class="fa fa-lock"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Sidebar -->
                <div class="col-lg-3">
                    <div class="middle-sidebar">
                        <!-- My Schedule -->
                        <div class="sidebar-section">
                            <h4 class="sidebar-title">
                                <i class="fa fa-calendar"></i> My Schedule
                                <a href="{{{calendarurl}}}" class="view-full-link">View Full Calendar ></a>
                            </h4>
                            <p class="schedule-subtitle">Next 7 Days</p>
                            <div class="calendar-week">
                                {{#calendar_week}}
                                <div class="calendar-day {{#has_events}}has-events{{/has_events}}" data-date="{{date}}">
                                    <div class="day-name">{{day_name}}</div>
                                    <div class="day-number">{{day_number}}</div>
                                    {{#has_events}}
                                    <div class="event-indicator">
                                        <div class="event-dot"></div>
                                    </div>
                                    {{/has_events}}
                                </div>
                                {{/calendar_week}}
                            </div>
                            
                            <!-- Upcoming Events List -->
                            <div class="upcoming-events">
                                {{#upcoming_events}}
                                <a href="{{event_url}}" class="event-item" target="_blank">
                                    <div class="event-date">
                                        <span class="event-day">{{event_day}}</span>
                                        <span class="event-month">{{event_month}}</span>
                                    </div>
                                    <div class="event-details">
                                        <div class="event-title">{{event_title}}</div>
                                        <div class="event-time">{{event_time}}</div>
                                        <div class="event-course">{{course_name}}</div>
                                    </div>
                                    <div class="event-type {{event_type}}">
                                        <i class="fa {{event_icon}}"></i>
                                    </div>
                                </a>
                                {{/upcoming_events}}
                                {{^upcoming_events}}
                                <div class="no-events">
                                    <i class="fa fa-calendar-o"></i>
                                    <p>No upcoming events in the next 7 days</p>
                                </div>
                                {{/upcoming_events}}
                            </div>
                        </div>
                        
                        <!-- Learning Progress -->
                        <div class="sidebar-section">
                            <h4 class="sidebar-title">Learning Progress</h4>
                            <div class="quick-stats-list">
                                <div class="quick-stat-item">
                                    <div class="stat-icon">
                                        <i class="fa fa-book"></i>
                                    </div>
                                    <div class="stat-details">
                                        <span class="stat-label">Active Courses</span>
                                        <span class="stat-value">3</span>
                                    </div>
                                </div>
                                <div class="quick-stat-item">
                                    <div class="stat-icon">
                                        <i class="fa fa-tasks"></i>
                                    </div>
                                    <div class="stat-details">
                                        <span class="stat-label">Completed Activities</span>
                                        <span class="stat-value">12</span>
                                    </div>
                                </div>
                                <div class="quick-stat-item">
                                    <div class="stat-icon">
                                        <i class="fa fa-calendar-check-o"></i>
                                    </div>
                                    <div class="stat-details">
                                        <span class="stat-label">Assignments Due</span>
                                        <span class="stat-value">2</span>
                                    </div>
                                </div>
                                <div class="quick-stat-item">
                                    <div class="stat-icon">
                                        <i class="fa fa-percent"></i>
                                    </div>
                                    <div class="stat-details">
                                        <span class="stat-label">Overall Progress</span>
                                        <span class="stat-value">68%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Achievements -->
                        <div class="sidebar-section">
                            <h4 class="sidebar-title">Achievements</h4>
                            <div class="achievements-content">
                                <div class="achievement-summary">
                                    <div class="achievement-badge-small earned">
                                        <i class="fa fa-book"></i>
                                        <span>3</span>
                                        <label>Courses</label>
                                    </div>
                                    <div class="achievement-badge-small earned">
                                        <i class="fa fa-tasks"></i>
                                        <span>12</span>
                                        <label>Activities</label>
                                    </div>
                                    <div class="achievement-badge-small earned">
                                        <i class="fa fa-calendar-check-o"></i>
                                        <span>5</span>
                                        <label>Assignments</label>
                                    </div>
                                </div>
                                <div class="achievement-progress">
                                    <div class="progress-item">
                                        <span class="progress-label">Course Completion</span>
                                        <div class="progress-bar-small">
                                            <div class="progress-fill-small" style="width: 68%"></div>
                            </div>
                                        <span class="progress-value">68%</span>
                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            
            <!-- Course Preview Modal -->
            <div id="coursePreviewModal" class="preview-modal">
                <div class="modal-overlay" onclick="closePreviewModal()"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="modalCourseTitle">Course Preview</h3>
                        <button class="modal-close" onclick="closePreviewModal()">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="course-sections-list" id="courseSectionsList">
                            <!-- Sections will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        {{/middle}}
    

    {{#middle}}
    <script>
    let currentCourseIndex = 0;
    const courses = document.querySelectorAll('.middle-course-card');
    const indicators = document.querySelectorAll('.indicator');
    
    function showCourse(index) {
        // Hide all courses
        courses.forEach(course => {
            course.style.display = 'none';
        });
        
        // Show current course
        if (courses[index]) {
            courses[index].style.display = 'block';
        }
        
        // Update indicators
        indicators.forEach((indicator, i) => {
            indicator.classList.toggle('active', i === index);
        });
        
        // Navigation buttons are always enabled for circular navigation
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');
        
        if (prevBtn) prevBtn.style.opacity = '1';
        if (nextBtn) nextBtn.style.opacity = '1';
    }
    
    function changeCourse(direction) {
        if (courses.length === 0) return;
        
        if (direction === 1) {
            // Move to next course (circular)
            currentCourseIndex = (currentCourseIndex + 1) % courses.length;
        } else {
            // Move to previous course (circular)
            currentCourseIndex = (currentCourseIndex - 1 + courses.length) % courses.length;
        }
        
        showCourse(currentCourseIndex);
    }
    
    function goToCourse(index) {
        if (index >= 0 && index < courses.length) {
            currentCourseIndex = index;
            showCourse(currentCourseIndex);
        }
    }
    
    // Initialize carousel
    document.addEventListener('DOMContentLoaded', function() {
        if (courses.length > 0) {
            showCourse(0);
        }
    });
    
    // Modal functionality
    function openPreviewModal(courseId, courseName) {
        const modal = document.getElementById('coursePreviewModal');
        const modalTitle = document.getElementById('modalCourseTitle');
        const sectionsList = document.getElementById('courseSectionsList');
        
        // Set modal title
        modalTitle.textContent = courseName + ' - Course Sections';
        
        // Show loading state
        sectionsList.innerHTML = '<div class="loading-spinner"><i class="fa fa-spinner fa-spin"></i> Loading sections...</div>';
        
        // Show modal
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // Load course sections via AJAX
        loadCourseSections(courseId, sectionsList);
    }
    
    function closePreviewModal() {
        const modal = document.getElementById('coursePreviewModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    function loadCourseSections(courseId, container) {
        // Create a simple AJAX request to load sections
        // For now, we'll simulate the data structure
        const sections = [
            { id: 1, name: 'Introduction to Digital Learning', description: 'Welcome to the course and overview of digital tools', activities: 3 },
            { id: 2, name: 'Basic Computer Skills', description: 'Learning fundamental computer operations', activities: 5 },
            { id: 3, name: 'Digital Safety and Security', description: 'Understanding online safety and privacy', activities: 4 },
            { id: 4, name: 'Creative Digital Projects', description: 'Hands-on projects using digital tools', activities: 6 },
            { id: 5, name: 'Assessment and Review', description: 'Final assessment and course review', activities: 2 }
        ];
        
        // Clear loading state
        container.innerHTML = '';
        
        // Add sections to the modal
        sections.forEach(section => {
            const sectionElement = document.createElement('div');
            sectionElement.className = 'section-item';
            sectionElement.innerHTML = `
                <div class="section-header">
                    <h4 class="section-name">${section.name}</h4>
                    <span class="section-activities">${section.activities} activities</span>
                </div>
                <p class="section-description">${section.description}</p>
            `;
            container.appendChild(sectionElement);
        });
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(e) {
        const modal = document.getElementById('coursePreviewModal');
        if (e.target === modal) {
            closePreviewModal();
        }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closePreviewModal();
        }
    });

    // Real-time course count update functions
    function refreshCourseCount() {
        console.log('refreshCourseCount called'); // Debug log
        const refreshIcon = document.getElementById('courses-refresh-icon');
        const coursesCount = document.getElementById('total-courses-count');
        const coursesUpdated = document.getElementById('courses-updated');

        if (!refreshIcon || !coursesCount || !coursesUpdated) {
            console.error('Required elements not found:', {refreshIcon, coursesCount, coursesUpdated});
            return;
        }

        // Show loading state
        refreshIcon.classList.add('fa-spin');
        console.log('Fetching data from: {{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php'); // Debug log

        // Fetch real-time data
        fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
            .then(response => {
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                return response.text(); // Get as text first
            })
            .then(text => {
                try {
                    const data = JSON.parse(text);
                    if (data.status === 'success') {
                        // Update the count with animation
                        animateCountUpdate(coursesCount, data.total_courses);
                        coursesUpdated.textContent = 'Last updated: ' + data.timestamp;

                        // Show success feedback
                        showUpdateFeedback('courses-card', 'success');
                    } else {
                        console.error('API Error:', data);
                        showUpdateFeedback('courses-card', 'error');
                    }
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError);
                    console.error('Response text:', text);
                    showUpdateFeedback('courses-card', 'error');
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                showUpdateFeedback('courses-card', 'error');
            })
            .finally(() => {
                // Remove loading state
                refreshIcon.classList.remove('fa-spin');
            });
    }

    function animateCountUpdate(element, newValue) {
        const currentValue = parseInt(element.textContent) || 0;
        const increment = newValue > currentValue ? 1 : -1;
        const duration = 1000; // 1 second
        const steps = Math.abs(newValue - currentValue);
        const stepDuration = duration / steps;

        let currentStep = 0;
        const timer = setInterval(() => {
            currentStep++;
            const newDisplayValue = currentValue + (increment * currentStep);
            element.textContent = newDisplayValue;

            if (currentStep >= steps) {
                clearInterval(timer);
                element.textContent = newValue;
            }
        }, stepDuration);
    }

    function showUpdateFeedback(cardId, type) {
        const card = document.getElementById(cardId);
        const feedback = document.createElement('div');
        feedback.className = `update-feedback ${type}`;
        feedback.textContent = type === 'success' ? '✓ Updated' : '✗ Error';
        feedback.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: ${type === 'success' ? '#4CAF50' : '#f44336'};
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        `;

        card.style.position = 'relative';
        card.appendChild(feedback);

        // Fade in
        setTimeout(() => feedback.style.opacity = '1', 10);

        // Fade out and remove
        setTimeout(() => {
            feedback.style.opacity = '0';
            setTimeout(() => card.removeChild(feedback), 300);
        }, 2000);
    }

    // Auto-refresh course count every 30 seconds
    setInterval(refreshCourseCount, 30000);

    // Middle school course count refresh function
    function refreshMiddleCourseCount() {
        console.log('refreshMiddleCourseCount called'); // Debug log
        const refreshIcon = document.getElementById('middle-courses-refresh-icon');
        const coursesCount = document.getElementById('middle-total-courses-count');
        const coursesUpdated = document.getElementById('middle-courses-updated');

        if (!refreshIcon || !coursesCount || !coursesUpdated) {
            console.error('Required elements not found:', {refreshIcon, coursesCount, coursesUpdated});
            return;
        }

        // Show loading state
        refreshIcon.classList.add('fa-spin');
        console.log('Fetching data from: {{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php'); // Debug log

        // Fetch real-time data
        fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
            .then(response => {
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                return response.text(); // Get as text first
            })
            .then(text => {
                try {
                    const data = JSON.parse(text);
                    if (data.status === 'success') {
                        // Update the count with animation
                        animateCountUpdate(coursesCount, data.total_courses);
                        coursesUpdated.textContent = 'Last updated: ' + data.timestamp;

                        // Show success feedback
                        showUpdateFeedback('middle-courses-card', 'success');
                    } else {
                        console.error('API Error:', data);
                        showUpdateFeedback('middle-courses-card', 'error');
                    }
                } catch (parseError) {
                    console.error('JSON Parse Error:', parseError);
                    console.error('Response text:', text);
                    showUpdateFeedback('middle-courses-card', 'error');
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                showUpdateFeedback('middle-courses-card', 'error');
            })
            .finally(() => {
                // Remove loading state
                refreshIcon.classList.remove('fa-spin');
            });
    }

    // Auto-refresh middle school course count every 30 seconds
    setInterval(refreshMiddleCourseCount, 30000);

    // Debug function to test AJAX endpoint
    function testAjaxEndpoint() {
        console.log('Testing AJAX endpoint...');
        fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
            .then(response => {
                console.log('Response status:', response.status);
                return response.text();
            })
            .then(text => {
                console.log('Raw response:', text);
                try {
                    const data = JSON.parse(text);
                    console.log('Parsed data:', data);
                    alert('AJAX Test Result: ' + JSON.stringify(data, null, 2));
                } catch (e) {
                    console.error('JSON parse error:', e);
                    alert('JSON Parse Error: ' + e.message + '\nRaw response: ' + text);
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                alert('Fetch Error: ' + error.message);
            });
    }

    // Add test button for debugging
    document.addEventListener('DOMContentLoaded', function() {
        // Add a test button for debugging (remove this in production)
        const testButton = document.createElement('button');
        testButton.textContent = 'Test AJAX';
        testButton.style.cssText = 'position: fixed; top: 10px; right: 10px; z-index: 9999; background: #007bff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;';
        testButton.onclick = testAjaxEndpoint;
        document.body.appendChild(testButton);
        
        console.log('Dashboard loaded, AJAX functions available');
    });
    </script>
    {{/middle}}

    
    {{#highschool}}
        <!-- Student Sidebar -->
        <div class="student-sidebar">
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="{{{dashboardurl}}}" class="nav-link active">
                            <i class="fa fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{mycoursesurl}}}" class="nav-link">
                            <i class="fa fa-book"></i>
                            <span>My Courses</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{gradesurl}}}" class="nav-link">
                            <i class="fa fa-chart-line"></i>
                            <span>My Grades</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{assignmentsurl}}}" class="nav-link">
                            <i class="fa fa-tasks"></i>
                            <span>Assignments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{messagesurl}}}" class="nav-link">
                            <i class="fa fa-envelope"></i>
                            <span>Messages</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{codeeditorurl}}}" class="nav-link">
                            <i class="fa fa-code"></i>
                            <span>Code Editor</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{{scratchurl}}}" class="nav-link">
                            <i class="fa fa-puzzle-piece"></i>
                            <span>Scratch Emulator</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name">{{student_name}}</div>
                        <div class="user-role">High School Student</div>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <a href="{{{profileurl}}}" class="action-btn profile-btn">
                        <i class="fa fa-user-circle"></i>
                        <span>Profile</span>
                    </a>
                    <a href="{{{logouturl}}}" class="action-btn logout-btn">
                        <i class="fa fa-sign-out"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
                                </div>

        <div class="highschool-dashboard">

            <!-- Main Analytics Dashboard -->
            <div class="analytics-dashboard highschool-dashboard">
                 <!-- Dashboard Metrics -->
                 <div class="dashboard-metrics">
                     {{#highschool_metrics}}
                     <div class="metric-card enrolled-courses">
                         <div class="metric-icon">
                             <i class="fa fa-book"></i>
                         </div>
                         <div class="metric-content">
                             <div class="metric-title">Enrolled Courses</div>
                             <div class="metric-value">{{enrolled_courses}}</div>
                             <div class="metric-trend {{#courses_trend}}positive{{/courses_trend}}{{^courses_trend}}neutral{{/courses_trend}}">
                                 {{#courses_trend}}<i class="fa fa-arrow-up"></i> +{{courses_trend}}%{{/courses_trend}}
                                 {{^courses_trend}}<i class="fa fa-minus"></i> 0%{{/courses_trend}}
                                 vs last quarter
                             </div>
                         </div>
                     </div>
                     
                     <div class="metric-card completed-assignments">
                         <div class="metric-icon">
                             <i class="fa fa-check-circle"></i>
                         </div>
                         <div class="metric-content">
                             <div class="metric-title">Completed Assignments</div>
                             <div class="metric-value">{{completed_assignments}}</div>
                             <div class="metric-trend {{#assignments_trend}}positive{{/assignments_trend}}{{^assignments_trend}}neutral{{/assignments_trend}}">
                                 {{#assignments_trend}}<i class="fa fa-arrow-up"></i> +{{assignments_trend}}%{{/assignments_trend}}
                                 {{^assignments_trend}}<i class="fa fa-minus"></i> 0%{{/assignments_trend}}
                                 vs last quarter
                             </div>
                         </div>
                     </div>
                     
                     <div class="metric-card pending-assignments">
                         <div class="metric-icon">
                             <i class="fa fa-clock"></i>
                         </div>
                         <div class="metric-content">
                             <div class="metric-title">Pending Assignments</div>
                             <div class="metric-value">{{pending_assignments}}</div>
                             <div class="metric-trend {{#pending_due_soon}}urgent{{/pending_due_soon}}{{^pending_due_soon}}neutral{{/pending_due_soon}}">
                                 {{#pending_due_soon}}Due soon{{/pending_due_soon}}
                                 {{^pending_due_soon}}All caught up{{/pending_due_soon}}
                             </div>
                         </div>
                     </div>
                     
                     <div class="metric-card average-grade">
                         <div class="metric-icon">
                             <i class="fa fa-trophy"></i>
                         </div>
                         <div class="metric-content">
                             <div class="metric-title">Average Grade</div>
                             <div class="metric-value">{{average_grade}}%</div>
                             <div class="metric-trend {{#grade_trend}}positive{{/grade_trend}}{{^grade_trend}}neutral{{/grade_trend}}">
                                 {{#grade_trend}}<i class="fa fa-arrow-up"></i> +{{grade_trend}}%{{/grade_trend}}
                                 {{^grade_trend}}<i class="fa fa-minus"></i> 0%{{/grade_trend}}
                                 vs last quarter
                             </div>
                         </div>
                     </div>
                     {{/highschool_metrics}}
                 </div>
            
                <!-- Main Content Area -->
                <div class="row">
                    <!-- Left Content Area -->
                    <div class="col-lg-9">
                        <!-- Current Courses Section -->
                        {{#has_highschool_courses}}
                        <div class="middle-courses-section">
                            <div class="section-header">
                                <h3 class="section-title">My Courses</h3>
                                <a href="{{{mycoursesurl}}}" class="view-all-link">View All ></a>
                            </div>
                            <div class="courses-static-grid">
                                {{#highschool_courses}}
                                <div class="middle-course-card">
                                    <div class="course-image-container">
                                        {{#courseimage}}
                                        <img src="{{courseimage}}" alt="{{fullname}}" class="course-image">
                                        {{/courseimage}}
                                        {{^courseimage}}
                                        <div class="course-image-placeholder">
                                            <i class="fa fa-book"></i>
                                        </div>
                                        {{/courseimage}}
                                        <div class="course-level-badge">Beginner</div>
                                    </div>
                                    
                                    <div class="course-content">
                                        <h4 class="course-title">{{fullname}}</h4>
                                        <p class="course-summary">{{#summary}}{{summary}}{{/summary}}{{^summary}}No description available{{/summary}}</p>
                                        
                                        <!-- Progress Bar -->
                                        <div class="course-progress-section">
                                            <div class="progress-label">Progress {{progress}}%</div>
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: {{progress}}%"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Course Stats -->
                                        <div class="course-stats">
                                            <div class="course-stat-item">
                                                <span>{{total_sections}}/{{total_sections}} lessons</span>
                                            </div>
                                        <div class="course-status">not started</div>
                                        
                                        <div class="course-buttons">
                                            <a href="{{courseurl}}" class="course-button primary">
                                                <i class="fa fa-play"></i> Continue Learning
                                            </a>
                                                    <button class="course-button secondary preview-btn" data-course="{{fullname}}" data-courseid="{{id}}">
                                                        <i class="fa fa-eye"></i> Preview
                                                    </button>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                                {{/highschool_courses}}
                            </div>
                        </div>
                        {{/has_highschool_courses}}
                    </div>
                    
                    <!-- Right Sidebar -->
                    <div class="col-lg-3">
                        <div class="middle-sidebar">
                            <!-- My Schedule -->
                        <div class="sidebar-section">
                            <h4 class="sidebar-title">
                                    <i class="fa fa-calendar"></i> My Schedule
                                    <a href="{{{calendarurl}}}" class="view-full-link">View Full Calendar ></a>
                            </h4>
                            <p class="schedule-subtitle">Next 7 Days</p>
                            <div class="calendar-week">
                                    {{#calendar_week}}
                                    <div class="calendar-day {{#has_events}}has-events{{/has_events}}" data-date="{{date}}">
                                        <div class="day-name">{{day_name}}</div>
                                        <div class="day-number">{{day_number}}</div>
                                        {{#has_events}}
                                        <div class="event-indicator">
                                            <div class="event-dot"></div>
                                </div>
                                        {{/has_events}}
                                </div>
                                    {{/calendar_week}}
                                </div>
                                
                                <!-- Upcoming Events List -->
                                <div class="upcoming-events">
                                    {{#upcoming_events}}
                                    <a href="{{event_url}}" class="event-item" target="_blank">
                                        <div class="event-date">
                                            <span class="event-day">{{event_day}}</span>
                                            <span class="event-month">{{event_month}}</span>
                                </div>
                                        <div class="event-details">
                                            <div class="event-title">{{event_title}}</div>
                                            <div class="event-time">{{event_time}}</div>
                                            <div class="event-course">{{course_name}}</div>
                                </div>
                                        <div class="event-type {{event_type}}">
                                            <i class="fa {{event_icon}}"></i>
                                </div>
                                    </a>
                                    {{/upcoming_events}}
                                    {{^upcoming_events}}
                                    <div class="no-events">
                                        <i class="fa fa-calendar-o"></i>
                                        <p>No upcoming events in the next 7 days</p>
                            </div>
                                    {{/upcoming_events}}
                        </div>
                    </div>
                            
                            <!-- Learning Progress -->
                            <div class="sidebar-section">
                                <h4 class="sidebar-title">Learning Progress</h4>
                                <div class="quick-stats-list">
                                    <div class="quick-stat-item">
                                        <div class="stat-icon">
                                            <i class="fa fa-book"></i>
                </div>
                                        <div class="stat-details">
                                            <span class="stat-label">Active Courses</span>
                                            <span class="stat-value">{{#highschool_stats}}{{courses}}{{/highschool_stats}}</span>
            </div>
                                          <div class="stat-icon">
                                            <i class="fa fa-tasks"></i>
        </div>
                                        <div class="stat-details">
                                            <span class="stat-label">Activities</span>
                                            <span class="stat-value">{{#highschool_stats}}{{activities}}{{/highschool_stats}}</span>
                                        </div>
                                </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Weekly Activity Chart -->
                <div class="weekly-activity-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fa fa-bar-chart"></i> This Week's Learning Activity
                        </h3>
                        <div class="chart-info">
                            <span class="info-text">Activities completed each day</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="weeklyActivityChart" width="800" height="300"></canvas>
                    </div>
                </div>
            
                <!-- Charts and Analytics -->
                <div class="charts-analytics">
                    <div class="chart-row">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3><i class="fa fa-line-chart"></i> Learning Progress Trend</h3>
                                <div class="chart-legend">
                                    <span class="legend-item">
                                        <span class="legend-color" style="background: #FF6B6B;"></span>
                                        Progress
                                    </span>
                                    <span class="legend-item">
                                        <span class="legend-color" style="background: #4ECDC4;"></span>
                                        Goals
                                    </span>
                                </div>
                            </div>
                            <div class="chart-content">
                                <canvas id="progressChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3><i class="fa fa-pie-chart"></i> Subject Performance</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="subjectChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            
               
                <!-- Active Sections and Additional Content Row -->
            <div class="row">
                    <!-- Left Half - Active Sections -->
                    <div class="col-lg-6">
                        <div class="active-sections">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fa fa-list-alt"></i> Active Sections
                                </h3>
                                <div class="section-info">
                                    <span class="info-text">Current course sections in progress</span>
                                </div>
                            </div>
                            <div class="sections-list">
                                {{#highschool_active_sections}}
                                <a href="{{url}}" class="section-item section-link">
                                    <div class="section-info">
                                        <h4 class="section-name">{{name}}</h4>
                                        <div class="course-name">{{coursename}}</div>
                                    </div>
                                    <div class="section-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{progress_percentage}}%; background: linear-gradient(90deg, #4ECDC4, #96CEB4);"></div>
                                        </div>
                                        <div class="progress-text">{{progress_percentage}}%</div>
                                    </div>
                                </a>
                                {{/highschool_active_sections}}
                                {{^highschool_active_sections}}
                                <div class="no-sections">
                                    <i class="fa fa-info-circle"></i>
                                    <p>No active sections found. Start a course to see your progress here.</p>
                                </div>
                                {{/highschool_active_sections}}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Half - Placeholder for future content -->
                    <div class="col-lg-6">
                        <!-- Future content can go here -->
                    </div>
                </div>
              
            </div>
        </div>
            
            <!-- Course Preview Modal -->
            <div id="highschoolCoursePreviewModal" class="preview-modal">
                <div class="modal-overlay" onclick="closePreviewModal()"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="modalCourseTitle">Course Preview</h3>
                        <button class="modal-close" onclick="closePreviewModal()">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="course-sections-list" id="courseSectionsList">
                            <!-- Sections will be loaded here -->
                        </div>
                        
                        <div class="insight-card study-stats">
                            <div class="insight-header">
                                <h3><i class="fa fa-lightbulb-o"></i> Study Insights</h3>
                            </div>
                            <div class="insight-content">
                                <div class="study-stat">
                                    <div class="stat-icon">
                                        <i class="fa fa-clock-o"></i>
                                    </div>
                                    <div class="stat-details">
                                        <h4>Peak Study Time</h4>
                                        <p>You're most productive between 2-4 PM</p>
                                    </div>
                                </div>
                                <div class="study-stat">
                                    <div class="stat-icon">
                                        <i class="fa fa-book"></i>
                                    </div>
                                    <div class="stat-details">
                                        <h4>Strongest Subject</h4>
                                        <p>Mathematics - 95% average</p>
                                    </div>
                                </div>
                                <div class="study-stat">
                                    <div class="stat-icon">
                                        <i class="fa fa-target"></i>
                                    </div>
                                    <div class="stat-details">
                                        <h4>Goal Progress</h4>
                                        <p>On track to complete 5 courses this semester</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
        </div>
    {{/highschool}}
     
     <!-- High School Dashboard JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize all components
        initializeProgressRings();
        initializeInteractiveElements();
        initializeAnalytics();
        initializeAnimations();
        
        // Initialize charts only for high school dashboard
        const highschoolDashboard = document.querySelector('.highschool-dashboard');
        console.log('High school dashboard found:', highschoolDashboard);
        if (highschoolDashboard) {
            console.log('Initializing charts for high school dashboard...');
            // Wait for Chart.js to load
            if (typeof Chart !== 'undefined') {
                initializeCharts();
            } else {
                console.log('Chart.js not loaded yet, waiting...');
                // Try again after a short delay
                setTimeout(() => {
                    if (typeof Chart !== 'undefined') {
                        console.log('Chart.js loaded after delay, initializing charts...');
                        initializeCharts();
                    } else {
                        console.error('Chart.js still not loaded after delay');
                    }
                }, 1000);
            }
        } else {
            console.log('No high school dashboard found, skipping chart initialization');
        }
    });
    
    function initializeProgressRings() {
        const progressRings = document.querySelectorAll('.progress-ring-fill');
        progressRings.forEach(ring => {
            const progress = ring.closest('.course-progress-circle').querySelector('.progress-text').textContent;
            const percentage = parseInt(progress.replace('%', ''));
            const circumference = 2 * Math.PI * 26; // radius = 26
            const offset = circumference - (percentage / 100) * circumference;
            
            ring.style.strokeDasharray = circumference;
            ring.style.strokeDashoffset = offset;
        });
    }
    
    function initializeInteractiveElements() {
        // Time selector buttons
        const timeBtns = document.querySelectorAll('.time-btn');
        timeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                timeBtns.forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                const period = this.dataset.period;
                updateAnalyticsData(period);
            });
        });
        
        // Course filter
        const courseFilter = document.querySelector('.filter-select');
        if (courseFilter) {
            courseFilter.addEventListener('change', function() {
                console.log('Course filter changed to:', this.value);
                filterCourses(this.value);
            });
        }
        
        // Course preview buttons
        const previewBtns = document.querySelectorAll('.preview-btn');
        previewBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const courseName = this.dataset.course;
                const courseId = this.dataset.courseid;
                console.log('Preview course:', courseName, courseId);
                
                // Add visual feedback
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
                
                showCoursePreview(courseId);
            });
        });
        
        // Deadline action buttons
        const deadlineActions = document.querySelectorAll('.deadline-action button');
        deadlineActions.forEach(btn => {
            btn.addEventListener('click', function() {
                const action = this.textContent.trim();
                console.log('Deadline action:', action);
                
                // Add visual feedback
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
                
                handleDeadlineAction(action, this);
            });
        });
    }
    
    function initializeCharts() {
        console.log('initializeCharts called');
        console.log('Chart.js available:', typeof Chart !== 'undefined');
        
        // Weekly Activity Chart
        const weeklyActivityCtx = document.getElementById('weeklyActivityChart');
        console.log('Weekly activity canvas found:', weeklyActivityCtx);
        if (weeklyActivityCtx) {
            createWeeklyActivityChart(weeklyActivityCtx);
        } else {
            console.error('Weekly activity canvas not found!');
        }
        
        // Progress Chart
        const progressCtx = document.getElementById('progressChart');
        console.log('Progress canvas found:', progressCtx);
        if (progressCtx) {
            createProgressChart(progressCtx);
        } else {
            console.error('Progress canvas not found!');
        }
        
        // Subject Chart
        const subjectCtx = document.getElementById('subjectChart');
        console.log('Subject canvas found:', subjectCtx);
        if (subjectCtx) {
            createSubjectChart(subjectCtx);
        } else {
            console.error('Subject canvas not found!');
        }
    }
    
    function createWeeklyActivityChart(canvas) {
        console.log('Creating weekly activity chart...');
        console.log('Canvas element:', canvas);
        
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('Chart.js is not loaded!');
            return;
        }
        
        // Dummy data for weekly activity completion
        const weeklyData = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Activities Completed',
                data: [3, 5, 2, 7, 4, 1, 0],
                backgroundColor: [
                    'rgba(255, 107, 107, 0.8)',   // Coral
                    'rgba(78, 205, 196, 0.8)',    // Teal
                    'rgba(52, 152, 219, 0.8)',    // Blue
                    'rgba(46, 204, 113, 0.8)',    // Green
                    'rgba(155, 89, 182, 0.8)',    // Purple
                    'rgba(241, 196, 15, 0.8)',    // Yellow
                    'rgba(149, 165, 166, 0.8)'    // Gray
                ],
                borderColor: [
                    'rgba(255, 107, 107, 1)',
                    'rgba(78, 205, 196, 1)',
                    'rgba(52, 152, 219, 1)',
                    'rgba(46, 204, 113, 1)',
                    'rgba(155, 89, 182, 1)',
                    'rgba(241, 196, 15, 1)',
                    'rgba(149, 165, 166, 1)'
                ],
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
            }]
        };

        const config = {
            type: 'bar',
            data: weeklyData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: false,
                        callbacks: {
                            title: function(context) {
                                return context[0].label + 'day';
                            },
                            label: function(context) {
                                return context.parsed.y + ' activities completed';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        ticks: {
                            stepSize: 1,
                            color: '#6B7280',
                            font: {
                                size: 12,
                                weight: '500'
                            }
                        },
                        grid: {
                            color: 'rgba(107, 114, 128, 0.1)',
                            drawBorder: false
                        },
                        border: {
                            display: false
                        }
                    },
                    x: {
                        ticks: {
                            color: '#6B7280',
                            font: {
                                size: 12,
                                weight: '500'
                            }
                        },
                        grid: {
                            display: false
                        },
                        border: {
                            display: false
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeInOutQuart',
                    delay: function(context) {
                        return context.dataIndex * 200;
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        };

        try {
            const chart = new Chart(canvas, config);
            console.log('Weekly activity chart created successfully:', chart);
        } catch (error) {
            console.error('Error creating weekly activity chart:', error);
        }
    }
    
    function createProgressChart(canvas) {
        console.log('Creating progress line chart...');
        console.log('Canvas element:', canvas);
        
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('Chart.js is not loaded!');
            return;
        }
        
        // Dummy data for learning progress over time (last 12 weeks)
        const progressData = {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8', 'Week 9', 'Week 10', 'Week 11', 'Week 12'],
            datasets: [{
                label: 'Learning Progress',
                data: [15, 22, 28, 35, 42, 48, 55, 61, 67, 72, 75, 78],
                borderColor: 'rgba(255, 107, 107, 1)',
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: 'rgba(255, 107, 107, 1)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }, {
                label: 'Target Goals',
                data: [20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75],
                borderColor: 'rgba(78, 205, 196, 1)',
                backgroundColor: 'rgba(78, 205, 196, 0.1)',
                borderWidth: 2,
                borderDash: [5, 5],
                fill: false,
                tension: 0.4,
                pointBackgroundColor: 'rgba(78, 205, 196, 1)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        };

        const config = {
            type: 'line',
            data: progressData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // We have custom legend in HTML
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 10,
                            color: '#6B7280',
                            font: {
                                size: 11,
                                weight: '500'
                            },
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        grid: {
                            color: 'rgba(107, 114, 128, 0.1)',
                            drawBorder: false
                        },
                        border: {
                            display: false
                        }
                    },
                    x: {
                        ticks: {
                            color: '#6B7280',
                            font: {
                                size: 11,
                                weight: '500'
                            },
                            maxTicksLimit: 8
                        },
                        grid: {
                            display: false
                        },
                        border: {
                            display: false
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeInOutQuart'
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        };

        try {
            const chart = new Chart(canvas, config);
            console.log('Progress line chart created successfully:', chart);
        } catch (error) {
            console.error('Error creating progress line chart:', error);
        }
    }
    
    function createSubjectChart(canvas) {
        console.log('Creating subject chart...');
        console.log('Canvas element:', canvas);
        
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            console.error('Chart.js is not loaded!');
            return;
        }
        
        const subjectData = {
            labels: ['Math', 'Science', 'English', 'History'],
            datasets: [{
                data: [35, 25, 20, 20],
                backgroundColor: [
                    'rgba(255, 107, 107, 0.8)',   // Coral
                    'rgba(78, 205, 196, 0.8)',    // Teal
                    'rgba(69, 183, 209, 0.8)',    // Blue
                    'rgba(150, 206, 180, 0.8)'    // Green
                ],
                borderColor: [
                    'rgba(255, 107, 107, 1)',
                    'rgba(78, 205, 196, 1)',
                    'rgba(69, 183, 209, 1)',
                    'rgba(150, 206, 180, 1)'
                ],
                borderWidth: 2
            }]
        };

        const config = {
            type: 'doughnut',
            data: subjectData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 12,
                                weight: '500'
                            },
                            color: '#6B7280'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                },
                cutout: '60%',
                animation: {
                    animateRotate: true,
                    duration: 2000
                }
            }
        };

        try {
            const chart = new Chart(canvas, config);
            console.log('Subject chart created successfully:', chart);
        } catch (error) {
            console.error('Error creating subject chart:', error);
        }
    }
    
    function initializeAnalytics() {
        // Simulate real-time data updates
        updateAnalyticsData('week');
        
        // Update analytics every 30 seconds
        setInterval(() => {
            const activeBtn = document.querySelector('.time-btn.active');
            if (activeBtn) {
                updateAnalyticsData(activeBtn.dataset.period);
            }
        }, 30000);
    }
    
    function updateAnalyticsData(period) {
        console.log('Updating analytics for period:', period);
        
        // Simulate data fetching based on period
        const mockData = {
            'week': {
                courses: 5,
                lessons: 23,
                activities: 18,
                progress: 78
            },
            'month': {
                courses: 5,
                lessons: 89,
                activities: 67,
                progress: 82
            },
            'semester': {
                courses: 6,
                lessons: 234,
                activities: 189,
                progress: 85
            }
        };
        
        const data = mockData[period] || mockData['week'];
        
        // Update metric cards with animation
        const metricCards = document.querySelectorAll('.metric-card');
        metricCards.forEach((card, index) => {
            const valueElement = card.querySelector('.metric-value');
            const currentValue = parseInt(valueElement.textContent);
            const targetValue = Object.values(data)[index];
            
            animateValue(valueElement, currentValue, targetValue, 1000);
        });
        
        // Update charts
        const progressCtx = document.getElementById('progressChart');
        if (progressCtx) {
            createProgressChart(progressCtx);
        }
    }
    
    function animateValue(element, start, end, duration) {
        const startTime = performance.now();
        
        function updateValue(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = Math.round(start + (end - start) * progress);
            element.textContent = current + (element.textContent.includes('%') ? '%' : '');
            
            if (progress < 1) {
                requestAnimationFrame(updateValue);
            }
        }
    };
    
    // Modal functionality - moved to jQuery require block below
    
    // Modal functionality - moved to jQuery require block below
    
    // Close modal when clicking outside
    document.addEventListener('click', function(e) {
        const modal = document.getElementById('highschoolCoursePreviewModal');
        if (e.target === modal) {
            closePreviewModal();
        }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closePreviewModal();
        }
     });
     
    function initializeAnimations() {
        // Add entrance animations
        const cards = document.querySelectorAll('.metric-card, .course-card, .insight-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    }
    
    function filterCourses(filter) {
        const courseCards = document.querySelectorAll('.course-card');
        
        courseCards.forEach(card => {
            const courseTitle = card.querySelector('.course-title').textContent.toLowerCase();
            let shouldShow = true;
            
            switch(filter) {
                case 'In Progress':
                    shouldShow = courseTitle.includes('math') || courseTitle.includes('science');
                    break;
                case 'Completed':
                    shouldShow = courseTitle.includes('english') || courseTitle.includes('history');
                    break;
                case 'Upcoming':
                    shouldShow = courseTitle.includes('art') || courseTitle.includes('music');
                    break;
            }
            
            card.style.display = shouldShow ? 'block' : 'none';
        });
    }
    
    function showCoursePreview(courseId) {
        console.log('Opening course preview for ID:', courseId);
        
        // Create a simple modal
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        `;
        
        modal.innerHTML = `
            <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 500px; text-align: center;">
                <h3>Course Preview</h3>
                <p>Course ID: ${courseId}</p>
                <p>This would show a detailed course preview with syllabus, requirements, and more.</p>
                <button onclick="this.closest('div').parentElement.remove()" style="background: #FF6B6B; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; margin-top: 1rem;">Close</button>
            </div>
        `;
        
        document.body.appendChild(modal);
    }
    
    function handleDeadlineAction(action, button) {
        const deadlineItem = button.closest('.deadline-item');
        const deadlineTitle = deadlineItem.querySelector('h4').textContent;
        
        console.log(`Handling ${action} for ${deadlineTitle}`);
        
        // Add visual feedback
        deadlineItem.style.background = '#C6F6D5';
        setTimeout(() => {
            deadlineItem.style.background = '';
        }, 2000);
        
        // Show success message
        const originalText = button.textContent;
        button.textContent = 'Done!';
        button.style.background = '#38A169';
        button.style.color = 'white';
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
            button.style.color = '';
        }, 2000);
    }
    
    // Add smooth scrolling for better UX
    function smoothScrollTo(element) {
        element.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }
    
    // Add keyboard navigation support
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case '1':
                    e.preventDefault();
                    const welcomeSection = document.querySelector('.highschool-welcome-header');
                    if (welcomeSection) smoothScrollTo(welcomeSection);
                    break;
                case '2':
                    e.preventDefault();
                    const coursesSection = document.querySelector('.course-management');
                    if (coursesSection) smoothScrollTo(coursesSection);
                    break;
                case '3':
                    e.preventDefault();
                    const insightsSection = document.querySelector('.learning-insights');
                    if (insightsSection) smoothScrollTo(insightsSection);
                    break;
        }
    }
});

// Enhanced Course Cards Functionality
function toggleCourseDetails(courseId) {
    const detailsPanel = document.getElementById('details-' + courseId);
    const detailsBtn = document.querySelector(`[onclick="toggleCourseDetails(${courseId})"]`);
    
    if (detailsPanel.style.display === 'none' || detailsPanel.style.display === '') {
        detailsPanel.style.display = 'block';
        detailsBtn.innerHTML = '<i class="fa fa-times"></i>';
        detailsBtn.classList.add('active');
    } else {
        detailsPanel.style.display = 'none';
        detailsBtn.innerHTML = '<i class="fa fa-info-circle"></i>';
        detailsBtn.classList.remove('active');
    }
}

// Course Card Animations and Interactions
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to course cards
    const courseCards = document.querySelectorAll('.elementary-course-card.enhanced');
    
    courseCards.forEach(card => {
        // Add entrance animation
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, Math.random() * 300);
        
        // Add hover effects
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
        });
    });
    
    // Animate progress bars
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
    
    // Add click animations to buttons
    const courseButtons = document.querySelectorAll('.course-button');
    courseButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 150);
        });
    });
});
</script>
    
    {{#default}}
        {{#school_manager_dashboard}}
        <!-- School Manager Dashboard with Sidebar -->
        <div class="school-manager-dashboard-wrapper">
            <!-- School Manager Sidebar -->
            <div class="school-manager-sidebar">
                <div class="sidebar-header">
                    <div class="school-info">
                        <h3 class="school-name">{{department_name}}</h3>
                        <p class="manager-role">School Manager</p>
                    </div>
                </div>
                
                <div class="sidebar-content">
                    <!-- Main Navigation Items -->
                    <div class="sidebar-section">
                        <ul class="sidebar-menu">
                            <li class="sidebar-item active">
                                <a href="#" class="sidebar-link" onclick="showDashboardContent()">
                                    <i class="fa fa-globe sidebar-icon"></i>
                                    <span class="sidebar-text">School Dashboard</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('teachers')">
                                    <i class="fa fa-user-tie sidebar-icon"></i>
                                    <span class="sidebar-text">Teacher Management</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('students')">
                                    <i class="fa fa-graduation-cap sidebar-icon"></i>
                                    <span class="sidebar-text">Student Management</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Management Section -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-category">MANAGEMENT</h3>
                        <ul class="sidebar-menu">
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('courses')">
                                    <i class="fa fa-book sidebar-icon"></i>
                                    <span class="sidebar-text">Course Management</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('enrollments')">
                                    <i class="fa fa-user-plus sidebar-icon"></i>
                                    <span class="sidebar-text">Enrollments</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('add_users')">
                                    <i class="fa fa-user-plus sidebar-icon"></i>
                                    <span class="sidebar-text">Add Users</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('bulk_upload')">
                                    <i class="fa fa-cloud-upload-alt sidebar-icon"></i>
                                    <span class="sidebar-text">Bulk Upload</span>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Reports & Analytics Section -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-category">REPORTS & ANALYTICS</h3>
                        <ul class="sidebar-menu">
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('analytics')">
                                    <i class="fa fa-chart-bar sidebar-icon"></i>
                                    <span class="sidebar-text">Analytics Dashboard</span>
                                </a>
                            </li>
                            <li class="sidebar-item">
                                <a href="#" class="sidebar-link" onclick="loadPage('reports')">
                                    <i class="fa fa-file-alt sidebar-icon"></i>
                                    <span class="sidebar-text">User Reports</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content Area with Sidebar -->
            <div class="dashboard-main-content-with-sidebar">
                <div id="dashboard-content">

                    <!-- Statistics Cards -->
                    <div class="stats-grid">
                        <div class="stat-card stat-teachers">
                            <div class="stat-icon">
                                <i class="fa fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">{{school_manager_stats.teachers_count}}</h3>
                                <p class="stat-label">TOTAL TEACHERS</p>
                                <div class="stat-footer">
                                    <span class="stat-status">
                                        <i class="fa fa-arrow-up text-success"></i> Active
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card stat-enrolled-teachers">
                            <div class="stat-icon">
                                <i class="fa fa-graduation-cap"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">{{school_manager_stats.teachers_count}}</h3>
                                <p class="stat-label">ENROLLED TEACHERS</p>
                                <div class="stat-footer">
                                    <span class="stat-status">
                                        <i class="fa fa-arrow-up text-success"></i> Active
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card stat-courses">
                            <div class="stat-icon">
                                <i class="fa fa-book"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">{{school_manager_stats.courses_count}}</h3>
                                <p class="stat-label">AVAILABLE COURSES</p>
                                <div class="stat-footer">
                                    <span class="stat-status">
                                        <i class="fa fa-arrow-up text-success"></i> Active
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card stat-enrollments">
                            <div class="stat-icon">
                                <i class="fa fa-user-plus"></i>
                            </div>
                            <div class="stat-content">
                                <h3 class="stat-number">{{school_manager_stats.total_enrollments}}</h3>
                                <p class="stat-label">ACTIVE ENROLLMENTS</p>
                                <div class="stat-footer">
                                    <span class="stat-status">
                                        <i class="fa fa-arrow-up text-success"></i> Current
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions-section">
                        <h2 class="section-title">Quick Actions</h2>
                        <div class="quick-actions-grid">
                            <div class="quick-action-card">
                                <div class="action-icon">
                                    <i class="fa fa-user-plus"></i>
                                </div>
                                <h3 class="action-title">Add Teacher</h3>
                                <p class="action-description">Add new teachers to your school</p>
                                <button class="action-btn" onclick="loadPage('add_users')">Add Teacher</button>
                            </div>

                            <div class="quick-action-card">
                                <div class="action-icon">
                                    <i class="fa fa-chalkboard-teacher"></i>
                                </div>
                                <h3 class="action-title">Enroll Teacher</h3>
                                <p class="action-description">Add teachers to your school</p>
                                <button class="action-btn" onclick="loadPage('enrollments')">Enroll Teacher</button>
                            </div>

                            <div class="quick-action-card">
                                <div class="action-icon">
                                    <i class="fa fa-book"></i>
                                </div>
                                <h3 class="action-title">View Courses</h3>
                                <p class="action-description">View and manage available courses</p>
                                <button class="action-btn" onclick="loadPage('courses')">View Courses</button>
                            </div>

                            <div class="quick-action-card">
                                <div class="action-icon">
                                    <i class="fa fa-chart-bar"></i>
                                </div>
                                <h3 class="action-title">View Reports</h3>
                                <p class="action-description">Access detailed analytics and reports</p>
                                <button class="action-btn" onclick="loadPage('reports')">View Reports</button>
                            </div>
                        </div>
                    </div>

                    <!-- Help Button -->
                    <div class="help-button">
                        <button class="help-btn" onclick="showHelp()">
                            <i class="fa fa-question"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {{/school_manager_dashboard}}

        {{^school_manager_dashboard}}
        <!-- Regular Default Dashboard -->
        <div class="default-dashboard">
            <div class="row">
                <div class="col-12">
                    <div class="card border-secondary">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0"><i class="fa fa-home"></i> Default Dashboard</h5>
                        </div>
                        <div class="card-body">
                            <p>This is the default dashboard for users not assigned to specific grade cohorts.</p>
                            <p>You can customize this dashboard or assign users to appropriate grade cohorts.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{/school_manager_dashboard}}
    {{/default}}
{{/dashboard_type}}

</div>

{{/custom_dashboard}}

<!-- School Manager Dashboard Styles -->
{{#school_manager_dashboard}}
<style>
.school-manager-dashboard-wrapper {
    display: flex;
    min-height: 100vh;
    background-color: #f8f9fa;
}

.school-manager-sidebar {
    width: 280px;
    background: #ffffff;
    color: #333333;
    position: fixed;
    height: 100vh;
    left: 0;
    top: 0;
    z-index: 1000;
    overflow-y: auto;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    border-right: 1px solid #e5e7eb;
}

.sidebar-header {
    padding: 2rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
}

.school-name {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
    color: #1f2937;
}

.manager-role {
    font-size: 0.875rem;
    color: #6b7280;
    margin: 0;
}

.sidebar-content {
    padding: 1rem 0;
}

.sidebar-section {
    margin-bottom: 2rem;
}

.sidebar-category {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 1.5rem;
    margin: 2rem 0 1rem 0;
    color: #9ca3af;
}

.sidebar-menu {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-item {
    margin: 0;
}

.sidebar-link {
    display: flex;
    align-items: center;
    padding: 0.875rem 1.5rem;
    color: #374151;
    text-decoration: none;
    transition: all 0.3s ease;
    border-radius: 0.375rem;
    margin: 0.25rem 1rem;
}

.sidebar-link:hover {
    background-color: #f3f4f6;
    color: #1f2937;
    text-decoration: none;
}

.sidebar-item.active .sidebar-link {
    background-color: #10b981;
    color: white;
}

.sidebar-icon {
    width: 20px;
    margin-right: 1rem;
    font-size: 1rem;
    text-align: center;
}

.sidebar-text {
    font-weight: 500;
    font-size: 0.875rem;
}

.dashboard-main-content-with-sidebar {
    margin-left: 280px;
    flex: 1;
    padding: 2rem;
    background-color: #f8f9fa;
    min-height: 100vh;
}


.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.15);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    font-size: 1.5rem;
    color: white;
}

.stat-teachers .stat-icon { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.stat-enrolled-teachers .stat-icon { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.stat-courses .stat-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
.stat-enrollments .stat-icon { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
    color: #374151;
}

.stat-label {
    font-size: 0.875rem;
    color: #6b7280;
    margin: 0 0 0.5rem 0;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-footer {
    display: flex;
    justify-content: flex-start;
    align-items: center;
}

.stat-status {
    font-size: 0.75rem;
    color: #059669;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.text-success {
    color: #059669;
}

.quick-actions-section {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #374151;
    margin: 0 0 1.5rem 0;
}

.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.quick-action-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.quick-action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}

.action-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem auto;
    color: white;
    font-size: 1.5rem;
}

.action-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #374151;
    margin: 0 0 0.5rem 0;
}

.action-description {
    font-size: 0.875rem;
    color: #9ca3af;
    margin: 0 0 1.5rem 0;
}

.action-btn {
    background: #667eea;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.3s ease;
    font-size: 0.875rem;
}

.action-btn:hover {
    background: #5a67d8;
}

/* Help Button */
.help-button {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 1000;
}

.help-btn {
    width: 50px;
    height: 50px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
}

.help-btn:hover {
    background: #5a67d8;
    transform: scale(1.1);
}

@media (max-width: 768px) {
    .school-manager-sidebar {
        width: 100%;
        position: relative;
        height: auto;
    }
    
    .dashboard-main-content-with-sidebar {
        margin-left: 0;
        padding: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .quick-actions-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function loadPage(page) {
    const contentDiv = document.getElementById('dashboard-content');
    contentDiv.innerHTML = '<div class="text-center p-4"><i class="fa fa-spinner fa-spin fa-2x"></i><p class="mt-2">Loading...</p></div>';
    
    // Remove active class from all sidebar items
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Add active class to clicked item
    event.target.closest('.sidebar-item').classList.add('active');
    
    // Load content based on page
    let url = '';
    switch(page) {
        case 'students':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/students_content.php';
            break;
        case 'teachers':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/teachers_content.php';
            break;
        case 'courses':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/courses_content.php';
            break;
        case 'reports':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/reports_content.php';
            break;
        case 'analytics':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/analytics.php';
            break;
        case 'enrollments':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/enrollments_content.php';
            break;
        case 'add_users':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/add_users_content.php';
            break;
        case 'bulk_upload':
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/bulk_upload_content.php';
            break;
        default:
            url = '{{wwwroot}}/theme/remui_kids/school_manager/ajax/students_content.php';
    }
    
    fetch(url)
        .then(response => response.text())
        .then(html => {
            contentDiv.innerHTML = html;
        })
        .catch(error => {
            contentDiv.innerHTML = '<div class="alert alert-danger">Error loading page content</div>';
        });
}

function showDashboardContent() {
    location.reload();
}

function showHelp() {
    alert('Help documentation would open here. This would typically show a help modal or redirect to a help page.');
}

</script>
{{/school_manager_dashboard}}

<!-- Regular Dashboard Content -->
<div class="dashboard-content">
    <div id="region-main-box" class="d-print-block">
        <section id="region-main" class="d-print-block" aria-label="{{#str}}content{{/str}}">
            <div class="rui-course-content">
                {{{ output.main_content }}}
            </div>
        </section>
    </div>
</div>

<!-- Course Preview Modal -->
<div id="middleCoursePreviewModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="middleCoursePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="middleCoursePreviewModalLabel">
                    <i class="fa fa-eye"></i> Course Preview
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="preview-content">
                    <div class="preview-header text-center mb-4">
                        <div class="preview-icon">
                            <i class="fa fa-book fa-3x text-primary mb-2"></i>
                        </div>
                        <h3 class="preview-title">Course Preview</h3>
                        <p class="course-name-display mb-3"></p>
                    </div>
                    
                    <div class="sections-container">
                        <h5 class="sections-title">
                            <i class="fa fa-list"></i> Course Sections
                        </h5>
                        <div class="sections-list" id="sectionsList">
                            <div class="loading-sections">
                                <i class="fa fa-spinner fa-spin"></i> Loading sections...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fa fa-times"></i> Close
                </button>
                <button type="button" class="btn btn-primary start-course-btn">
                    <i class="fa fa-play"></i> Start Course
                </button>
            </div>
        </div>
    </div>
</div>

<script>

// Global functions that need to be accessible from onclick attributes
function openPreviewModal(courseId, courseName) {
    console.log('Global openPreviewModal called with:', courseId, courseName);
    
    const modal = document.getElementById('highschoolCoursePreviewModal');
    const modalTitle = document.getElementById('modalCourseTitle');
    const sectionsList = document.getElementById('courseSectionsList');
    
    if (!modal || !modalTitle || !sectionsList) {
        console.error('Modal elements not found');
        return;
    }
    
    // Set modal title
    modalTitle.textContent = courseName + ' - Course Sections';
    
    // Show loading state
    sectionsList.innerHTML = '<div class="loading-spinner"><i class="fa fa-spinner fa-spin"></i> Loading sections...</div>';
    
    // Show modal
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Load course sections
    loadCourseSections(courseId, sectionsList);
}

function closePreviewModal() {
    const modal = document.getElementById('highschoolCoursePreviewModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

function loadCourseSections(courseId, container) {
    console.log('loadCourseSections called with courseId:', courseId);
    
    // Get course sections data from PHP
    var coursesSectionsData = {};
    try {
        var rawData = '{{{highschool_courses_sections}}}';
        console.log('Raw highschool_courses_sections data:', rawData);
        // Clean the JSON data by removing problematic characters
        rawData = rawData.replace(/&amp;/g, '&');
        rawData = rawData.replace(/&lt;/g, '<');
        rawData = rawData.replace(/&gt;/g, '>');
        rawData = rawData.replace(/&quot;/g, '"');
        rawData = rawData.replace(/&#x27;/g, "'");
        coursesSectionsData = JSON.parse(rawData);
        console.log('High school course sections data loaded:', coursesSectionsData);
        console.log('Available course IDs:', Object.keys(coursesSectionsData));
    } catch (e) {
        console.error('Error parsing high school course sections data:', e);
        console.log('Raw data:', '{{{highschool_courses_sections}}}');
    }
    
    // Clear loading state
    if (container) {
        container.innerHTML = '';
    }
    
    // Try both string and number keys
    var sectionsData = coursesSectionsData[courseId] || coursesSectionsData[String(courseId)] || coursesSectionsData[Number(courseId)];
    console.log('Sections data for course:', sectionsData);
    console.log('CourseId type:', typeof courseId, 'Value:', courseId);
    
    if (!sectionsData || !sectionsData.sections || sectionsData.sections.length === 0) {
        console.log('No sections data available for course ID:', courseId);
        console.log('Available course IDs in data:', Object.keys(coursesSectionsData));
        if (container) {
            container.innerHTML = '<div class="no-sections"><i class="fa fa-info-circle"></i> No sections available for this course. The course may not have any activities yet.</div>';
        }
        return;
    }
    
    var sectionsHtml = '';
    
    // Add sections to the modal with tree view
    sectionsData.sections.forEach(function(section, index) {
        var progressBar = '';
        if (section.total_activities > 0) {
            var progressPercent = section.progress;
            progressBar = '<div class="section-progress"><div class="progress-bar"><div class="progress-fill" style="width: ' + progressPercent + '%"></div></div><span class="progress-text">' + section.completed_activities + '/' + section.total_activities + ' activities</span></div>';
        }
        
        // Activities list (initially hidden)
        var activitiesList = '';
        if (section.activities && section.activities.length > 0) {
            activitiesList = '<div class="section-activities collapsed" id="highschool-activities-' + index + '">';
            activitiesList += '<div class="activities-header"><span class="activities-count">' + section.activities.length + ' activities</span></div>';
            activitiesList += '<ul class="activities-list">';
            
            section.activities.forEach(function(activity) {
                var statusIcon = activity.iscompleted ? 'fa-check-circle' : 'fa-circle-o';
                var activityType = activity.modname || 'activity';
                var activityIcon = getActivityIcon(activityType);
                
                activitiesList += '<li class="activity-item ' + (activity.iscompleted ? 'completed' : 'pending') + '">';
                activitiesList += '<div class="activity-icon"><i class="fa ' + activityIcon + '"></i></div>';
                activitiesList += '<div class="activity-details">';
                activitiesList += '<div class="activity-name">' + activity.name + '</div>';
                activitiesList += '<div class="activity-type">' + activityType.charAt(0).toUpperCase() + activityType.slice(1) + '</div>';
                activitiesList += '</div>';
                activitiesList += '<div class="activity-status"><i class="fa ' + statusIcon + '"></i></div>';
                activitiesList += '</li>';
            });
            
            activitiesList += '</ul></div>';
        }
        
        sectionsHtml += '<div class="section-item">';
        sectionsHtml += '<div class="section-header" onclick="toggleActivities(\'highschool-activities-' + index + '\')">';
        sectionsHtml += '<div class="section-info">';
        sectionsHtml += '<h4 class="section-name">' + section.name + '</h4>';
        sectionsHtml += '<p class="section-description">' + (section.summary || 'No description available') + '</p>';
        sectionsHtml += '</div>';
        sectionsHtml += '<div class="section-meta">';
        sectionsHtml += '<span class="section-activities-count">' + section.total_activities + ' activities</span>';
        if (section.activities && section.activities.length > 0) {
            sectionsHtml += '<i class="fa fa-chevron-down toggle-icon"></i>';
        }
        sectionsHtml += '</div>';
        sectionsHtml += '</div>';
        sectionsHtml += progressBar;
        sectionsHtml += activitiesList;
        sectionsHtml += '</div>';
    });
    
    if (container) {
        container.innerHTML = sectionsHtml;
    }
}

function getActivityIcon(activityType) {
    var icons = {
        'assign': 'fa-file-text-o',
        'quiz': 'fa-question-circle',
        'lesson': 'fa-book',
        'forum': 'fa-comments',
        'resource': 'fa-file-o',
        'url': 'fa-external-link',
        'page': 'fa-file-text',
        'folder': 'fa-folder',
        'label': 'fa-tag'
    };
    return icons[activityType] || 'fa-circle';
}

function toggleActivities(activitiesId) {
    var activitiesDiv = document.getElementById(activitiesId);
    if (activitiesDiv) {
        var toggleIcon = activitiesDiv.previousElementSibling.querySelector('.toggle-icon');
        
        if (activitiesDiv.classList.contains('collapsed')) {
            activitiesDiv.classList.remove('collapsed');
            activitiesDiv.classList.add('expanded');
            if (toggleIcon) {
                toggleIcon.classList.remove('fa-chevron-down');
                toggleIcon.classList.add('fa-chevron-up');
            }
        } else {
            activitiesDiv.classList.remove('expanded');
            activitiesDiv.classList.add('collapsed');
            if (toggleIcon) {
                toggleIcon.classList.remove('fa-chevron-up');
                toggleIcon.classList.add('fa-chevron-down');
            }
        }
    }
}

// Check if RequireJS is available, otherwise use jQuery directly
if (typeof require !== 'undefined') {
    require(['jquery'], function($) {
        $(document).ready(function() {
        // Store course sections data from PHP (global variable)
        window.coursesSectionsData = {};
        try {
            var rawData = '{{{middle_courses_sections}}}';
            
            // Check if rawData is empty or undefined
            if (!rawData || rawData.trim() === '' || rawData === 'undefined' || rawData === 'null') {
                console.log('No course sections data provided, using empty object');
                window.coursesSectionsData = {};
            } else {
                // Clean the JSON data by removing problematic characters
                rawData = rawData.replace(/&amp;/g, '&');
                rawData = rawData.replace(/&lt;/g, '<');
                rawData = rawData.replace(/&gt;/g, '>');
                rawData = rawData.replace(/&quot;/g, '"');
                rawData = rawData.replace(/&#x27;/g, "'");
                
                // Validate JSON before parsing
                if (rawData.trim().startsWith('{') || rawData.trim().startsWith('[')) {
                    window.coursesSectionsData = JSON.parse(rawData);
                    console.log('Course sections data loaded:', window.coursesSectionsData);
                } else {
                    console.log('Invalid JSON format, using empty object');
                    window.coursesSectionsData = {};
                }
            }
        } catch (e) {
            console.error('Error parsing course sections data:', e);
            console.log('Raw data received:', '{{{middle_courses_sections}}}');
            window.coursesSectionsData = {};
        }
        
        // Handle Preview button clicks for high school dashboard
        $('.highschool-dashboard .preview-btn').on('click', function(e) {
            e.preventDefault();
            console.log('High school preview button clicked');
            
            // Get course data from attributes
            var courseName = $(this).data('course');
            var courseId = $(this).data('courseid');
            
            console.log('High school course name:', courseName, 'Course ID:', courseId);
            
            // Call the modal function
            openPreviewModal(courseId, courseName);
        });
        
        // Handle Preview button clicks for middle school dashboard
        $('.middle-dashboard .preview-btn').on('click', function(e) {
            e.preventDefault();
            console.log('Middle school preview button clicked');
            
            // Get course data from attributes
            var courseName = $(this).data('course');
            var courseId = $(this).data('courseid');
            
            console.log('Middle school course name:', courseName, 'Course ID:', courseId);
            
            // Update modal content
            var courseNameDisplay = document.querySelector('.course-name-display');
            if (courseNameDisplay) {
                courseNameDisplay.textContent = courseName;
            }
            
            // Show loading state
            var sectionsList = document.getElementById('sectionsList');
            if (sectionsList) {
                sectionsList.innerHTML = '<div class="loading-sections"><i class="fa fa-spinner fa-spin"></i> Loading sections...</div>';
            }
            
            // Show the modal
            console.log('Attempting to show modal');
            $('#middleCoursePreviewModal').modal('show');
            
            // Display course sections
            displayCourseSections(courseId);
        });
        
        // Test if modal exists
        console.log('Modal element exists:', $('#middleCoursePreviewModal').length > 0);
        console.log('Preview buttons found:', $('.preview-btn').length);
        
        // Test modal functionality
        if ($('#middleCoursePreviewModal').length > 0) {
            console.log('Modal HTML:', $('#middleCoursePreviewModal')[0].outerHTML.substring(0, 200) + '...');
        }
        
        // Add a simple test to show modal
        setTimeout(function() {
            console.log('Testing modal show after 2 seconds...');
            // Uncomment the line below to test modal functionality
            // $('#middleCoursePreviewModal').modal('show');
        }, 2000);
        
        // Function to display course sections with tree view (global function)
        window.displayCourseSections = function(courseId) {
            console.log('Displaying sections for course ID:', courseId);
            console.log('Available course data:', window.coursesSectionsData);
            
            var sectionsData = window.coursesSectionsData[courseId];
            console.log('Sections data for course:', sectionsData);
            
            if (!sectionsData || !sectionsData.sections || sectionsData.sections.length === 0) {
                console.log('No sections data available for course:', courseId);
                var sectionsList = document.getElementById('sectionsList');
                if (sectionsList) {
                    sectionsList.innerHTML = '<div class="no-sections"><i class="fa fa-info-circle"></i> No sections available for this course. The course may not have any activities yet.</div>';
                } else {
                    console.error('sectionsList element not found');
                }
                return;
            }
            
            var sectionsHtml = '';
            
            sectionsData.sections.forEach(function(section, index) {
                var progressBar = '';
                if (section.total_activities > 0) {
                    var progressPercent = section.progress;
                    progressBar = '<div class="section-progress"><div class="progress-bar"><div class="progress-fill" style="width: ' + progressPercent + '%"></div></div><span class="progress-text">' + section.completed_activities + '/' + section.total_activities + ' activities</span></div>';
                }
                
                // Activities list (initially hidden)
                var activitiesList = '';
                if (section.activities && section.activities.length > 0) {
                    activitiesList = '<div class="section-activities collapsed" id="activities-' + index + '">';
                    activitiesList += '<div class="activities-header"><span class="activities-count">' + section.activities.length + ' activities</span></div>';
                    activitiesList += '<ul class="activities-list">';
                    
                    section.activities.forEach(function(activity) {
                        var statusIcon = activity.iscompleted ? 'fa-check-circle' : 'fa-circle-o';
                        var activityType = activity.modname || 'activity';
                        var activityIcon = getActivityIcon(activity.modname);
                        var buttonText = activity.iscompleted ? 'Review' : 'Start';
                        var buttonClass = activity.iscompleted ? 'review-btn' : 'start-btn';
                        
                        activitiesList += '<li class="activity-item">' +
                            '<div class="activity-icon">' + activityIcon + '</div>' +
                            '<div class="activity-content">' +
                                '<div class="activity-name">' + activity.name + '</div>' +
                                '<div class="activity-meta">' + activityType + '</div>' +
                            '</div>' +
                            '<div class="activity-actions">' +
                                '<div class="activity-status ' + (activity.iscompleted ? 'completed' : 'pending') + '">' +
                                    '<i class="fa ' + statusIcon + '"></i>' +
                                '</div>' +
                                '<a href="' + activity.url + '" class="activity-start-btn ' + buttonClass + '" target="_blank">' +
                                    '<i class="fa fa-play"></i> ' + buttonText +
                                '</a>' +
                            '</div>' +
                        '</li>';
                    });
                    
                    activitiesList += '</ul></div>';
                }
                
                sectionsHtml += '<div class="section-item" data-section-index="' + index + '">' +
                    '<div class="section-header clickable" onclick="toggleSection(' + index + ')">' +
                        '<div class="section-left">' +
                            '<i class="fa fa-chevron-right section-toggle-icon" id="toggle-' + index + '"></i>' +
                            '<div class="section-info">' +
                                '<h6 class="section-name">' + section.name + '</h6>' +
                                '<div class="section-meta">' + section.total_activities + ' activities</div>' +
                            '</div>' +
                        '</div>' +
                        '<div class="section-right">' +
                            '<a href="' + section.url + '" class="section-start-btn" target="_blank">' +
                                '<i class="fa fa-play"></i> Start Section' +
                            '</a>' +
                        '</div>' +
                    '</div>' +
                    progressBar +
                    activitiesList +
                '</div>';
            });
            
            var sectionsListElement = document.getElementById('sectionsList');
            if (sectionsListElement) {
                sectionsListElement.innerHTML = sectionsHtml;
            } else {
                console.error('sectionsList element not found');
            }
        }
        
        // Function to toggle section expansion
        window.toggleSection = function(index) {
            var activitiesDiv = $('#activities-' + index);
            var toggleIcon = $('#toggle-' + index);
            
            if (activitiesDiv.hasClass('collapsed')) {
                // Expand
                activitiesDiv.removeClass('collapsed').addClass('expanded');
                toggleIcon.removeClass('fa-chevron-right').addClass('fa-chevron-down');
            } else {
                // Collapse
                activitiesDiv.removeClass('expanded').addClass('collapsed');
                toggleIcon.removeClass('fa-chevron-down').addClass('fa-chevron-right');
            }
        }
        
        // Function to get activity icon based on module type
        function getActivityIcon(modname) {
            var icons = {
                'quiz': '<i class="fa fa-question-circle"></i>',
                'assign': '<i class="fa fa-file-text"></i>',
                'page': '<i class="fa fa-file"></i>',
                'lesson': '<i class="fa fa-graduation-cap"></i>',
                'forum': '<i class="fa fa-comments"></i>',
                'scorm': '<i class="fa fa-laptop"></i>',
                'book': '<i class="fa fa-book"></i>',
                'url': '<i class="fa fa-external-link"></i>',
                'video': '<i class="fa fa-play-circle"></i>',
                'resource': '<i class="fa fa-file"></i>'
            };
            return icons[modname] || '<i class="fa fa-star"></i>';
        }
        
        // Handle Start Course button in modal
        $('.start-course-btn').on('click', function() {
            // Close modal
            $('#middleCoursePreviewModal').modal('hide');
            
            // Find the corresponding Continue Learning button and click it
            var courseName = $('.course-name-display').text();
            
            // Find the course card with matching name and click its Continue Learning button
            $('.middle-course-card').each(function() {
                var cardCourseName = $(this).find('.course-title').text().trim();
                if (cardCourseName === courseName) {
                    $(this).find('.course-button.primary').click();
                    return false; // Break the loop
                }
            });
        });
    });
    
    // Student Sidebar Functionality
    $(document).ready(function() {
        // Add body class for content shifting
        $('body').addClass('has-student-sidebar');
        
        // Handle sidebar navigation clicks - only for links with href="#"
        $('.student-sidebar .nav-link[href="#"]').on('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links
            $('.student-sidebar .nav-link').removeClass('active');
            
            // Add active class to clicked link
            $(this).addClass('active');
            
            // Get the link text to determine action
            var linkText = $(this).find('.nav-text').text().trim();
            
            // Get the current base URL
            var baseUrl = window.location.origin + window.location.pathname.split('/').slice(0, -1).join('/');
            if (baseUrl.endsWith('/')) {
                baseUrl = baseUrl.slice(0, -1);
            }
            
            // Handle different navigation items
            switch(linkText) {
                case 'Home':
                    // Already on home/dashboard
                    break;
                case 'Dashboard':
                    window.location.href = baseUrl + '/';
                    break;
                case 'My Courses':
                    window.location.href = baseUrl + '/courses.php';
                    break;
                case 'My Grades':
                    window.location.href = baseUrl + '/grade/report/user/index.php';
                    break;
                case 'Assignments':
                    window.location.href = baseUrl + '/mod/assign/index.php';
                    break;
                case 'Messages':
                    window.location.href = baseUrl + '/message/index.php';
                    break;
                case 'Code Editor':
                    // Open code editor in new tab
                    window.open(baseUrl + '/mod/codeeditor/view.php', '_blank');
                    break;
                case 'Scratch Emulator':
                    // Open scratch emulator in new tab
                    window.open(baseUrl + '/mod/scratch/view.php', '_blank');
                    break;
                default:
                    console.log('Navigation to:', linkText);
            }
        });
        
        // Mobile sidebar toggle (if needed)
        $('.student-sidebar-toggle').on('click', function() {
            $('.student-sidebar').toggleClass('show');
        });
    });
    });
} else {
    // Fallback for when RequireJS is not available
    document.addEventListener('DOMContentLoaded', function() {
        // Same functionality but without jQuery dependency
        window.coursesSectionsData = {};
        try {
            var rawData = '{{{middle_courses_sections}}}';
            
            // Check if rawData is empty or undefined
            if (!rawData || rawData.trim() === '' || rawData === 'undefined' || rawData === 'null') {
                console.log('No course sections data provided, using empty object');
                window.coursesSectionsData = {};
            } else {
                // Clean the JSON data by removing problematic characters
                rawData = rawData.replace(/&amp;/g, '&');
                rawData = rawData.replace(/&lt;/g, '<');
                rawData = rawData.replace(/&gt;/g, '>');
                rawData = rawData.replace(/&quot;/g, '"');
                rawData = rawData.replace(/&#x27;/g, "'");
                
                // Validate JSON before parsing
                if (rawData.trim().startsWith('{') || rawData.trim().startsWith('[')) {
                    window.coursesSectionsData = JSON.parse(rawData);
                    console.log('Course sections data loaded:', window.coursesSectionsData);
                } else {
                    console.log('Invalid JSON format, using empty object');
                    window.coursesSectionsData = {};
                }
            }
        } catch (e) {
            console.error('Error parsing course sections data:', e);
            console.log('Raw data received:', '{{{middle_courses_sections}}}');
            window.coursesSectionsData = {};
        }
        
        // Handle Preview button clicks for high school dashboard
        var highschoolPreviewBtns = document.querySelectorAll('.highschool-dashboard .preview-btn');
        highschoolPreviewBtns.forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('High school preview button clicked');
                
                var courseName = this.getAttribute('data-course');
                var courseId = this.getAttribute('data-courseid');
                
                console.log('High school course name:', courseName, 'Course ID:', courseId);
                
                // Call the modal function
                openPreviewModal(courseId, courseName);
            });
        });
        
        // Handle Preview button clicks for middle school dashboard
        var middlePreviewBtns = document.querySelectorAll('.middle-dashboard .preview-btn');
        middlePreviewBtns.forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Middle school preview button clicked');
                
                var courseName = this.getAttribute('data-course');
                var courseId = this.getAttribute('data-courseid');
                
                console.log('Middle school course name:', courseName, 'Course ID:', courseId);
                
                // Update modal content
                var courseNameDisplay = document.querySelector('.course-name-display');
                if (courseNameDisplay) {
                    courseNameDisplay.textContent = courseName;
                }
                
                // Show loading state
                var sectionsList = document.getElementById('sectionsList');
                if (sectionsList) {
                    sectionsList.innerHTML = '<div class="loading-sections"><i class="fa fa-spinner fa-spin"></i> Loading sections...</div>';
                }
                
                // Show the modal (using Bootstrap modal if available)
                var modal = document.getElementById('middleCoursePreviewModal');
                if (modal && typeof bootstrap !== 'undefined') {
                    var bsModal = new bootstrap.Modal(modal);
                    bsModal.show();
                } else if (modal) {
                    modal.style.display = 'block';
                }
                
                // Display course sections
                displayCourseSections(courseId);
            });
        });
        
        // Mobile sidebar toggle (if needed)
        var sidebarToggle = document.querySelector('.student-sidebar-toggle');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', function() {
                var sidebar = document.querySelector('.student-sidebar');
                if (sidebar) {
                    sidebar.classList.toggle('show');
                }
            });
        }
    });
}
    </script>
{{> theme_remui/common_end}}
