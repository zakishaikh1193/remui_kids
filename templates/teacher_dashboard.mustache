{{!
    Teacher Dashboard Template for remui_kids theme
    
    This template provides a teacher dashboard interface with course management,
    student tracking, and assignment monitoring capabilities.
}}

{{> theme_remui_kids/common_start}}

{{#teacher_dashboard}}
<!-- Full Screen Teacher Dashboard Wrapper -->
<div class="teacher-dashboard-wrapper">
    <!-- Mobile Sidebar Toggle Button -->
    <button class="sidebar-toggle" onclick="toggleTeacherSidebar()">
        <i class="fa fa-bars"></i>
    </button>

<!-- Teacher Dashboard Header -->
<div class="teacher-dashboard-header">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="teacher-dashboard-title mb-2">
                    Teacher Dashboard
                </h1>
                <p class="teacher-dashboard-subtitle mb-0">
                    Welcome back, Teacher! Here's your teaching overview
                </p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="teacher-dashboard-badge">
                    <i class="fa fa-chalkboard-teacher"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Teacher Sidebar Navigation -->
<div class="teacher-sidebar">
    <div class="sidebar-content">
        <!-- DASHBOARD Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">DASHBOARD</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/my/" class="sidebar-link">
                        <i class="fa fa-th-large sidebar-icon"></i>
                        <span class="sidebar-text">Teacher Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php" class="sidebar-link">
                        <i class="fa fa-book sidebar-icon"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/grade/report/grader/index.php" class="sidebar-link">
                        <i class="fa fa-graduation-cap sidebar-icon"></i>
                        <span class="sidebar-text">Gradebook</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/mod/assign/index.php" class="sidebar-link">
                        <i class="fa fa-tasks sidebar-icon"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- COURSES Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">COURSES</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php" class="sidebar-link">
                        <i class="fa fa-book sidebar-icon"></i>
                        <span class="sidebar-text">All Courses</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/edit.php" class="sidebar-link">
                        <i class="fa fa-plus sidebar-icon"></i>
                        <span class="sidebar-text">Create Course</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php?categoryid=0" class="sidebar-link">
                        <i class="fa fa-folder sidebar-icon"></i>
                        <span class="sidebar-text">Course Categories</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- STUDENTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">STUDENTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/user/index.php" class="sidebar-link">
                        <i class="fa fa-users sidebar-icon"></i>
                        <span class="sidebar-text">All Students</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/enrol/users.php" class="sidebar-link">
                        <i class="fa fa-user-plus sidebar-icon"></i>
                        <span class="sidebar-text">Enroll Students</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/progress/index.php" class="sidebar-link">
                        <i class="fa fa-chart-line sidebar-icon"></i>
                        <span class="sidebar-text">Progress Reports</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ASSESSMENTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">ASSESSMENTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/mod/assign/index.php" class="sidebar-link">
                        <i class="fa fa-tasks sidebar-icon"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/mod/quiz/index.php" class="sidebar-link">
                        <i class="fa fa-question-circle sidebar-icon"></i>
                        <span class="sidebar-text">Quizzes</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/grade/report/grader/index.php" class="sidebar-link">
                        <i class="fa fa-star sidebar-icon"></i>
                        <span class="sidebar-text">Grading</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- REPORTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">REPORTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/log/index.php" class="sidebar-link">
                        <i class="fa fa-chart-bar sidebar-icon"></i>
                        <span class="sidebar-text">Activity Logs</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/outline/index.php" class="sidebar-link">
                        <i class="fa fa-file-alt sidebar-icon"></i>
                        <span class="sidebar-text">Course Reports</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/progress/index.php" class="sidebar-link">
                        <i class="fa fa-chart-line sidebar-icon"></i>
                        <span class="sidebar-text">Progress Tracking</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Main Content Area with Sidebar -->
<div class="teacher-main-content">

<!-- Teacher Dashboard Statistics -->
<div class="teacher-dashboard-stats">
    <div class="stats-section-container">
        <div class="section-header">
            <h3 class="section-title">Dashboard</h3>
            <p class="section-subtitle">Key teaching metrics and course overview</p>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="teacher-stats-container">
                    {{#teacher_stats}}
                    <!-- Total Courses Card -->
                    <div class="teacher-stat-card courses-card" id="courses-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-book stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-courses-count">{{total_courses}}</div>
                            <div class="stat-label">TOTAL COURSES</div>
                            <div class="stat-status">• Teaching</div>
                            <div class="stat-updated" id="courses-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{last_updated}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshCourseCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="courses-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Total Students Card -->
                    <div class="teacher-stat-card students-card" id="students-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-users stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-students-count">{{total_students}}</div>
                            <div class="stat-label">TOTAL STUDENTS</div>
                            <div class="stat-status">• Enrolled</div>
                            <div class="stat-updated" id="students-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{last_updated}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshStudentCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="students-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Pending Assignments Card -->
                    <div class="teacher-stat-card assignments-card" id="assignments-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-tasks stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="pending-assignments-count">{{pending_assignments}}</div>
                            <div class="stat-label">PENDING ASSIGNMENTS</div>
                            <div class="stat-status">• To Grade</div>
                            <div class="stat-updated" id="assignments-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{last_updated}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshAssignmentCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="assignments-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Upcoming Classes Card -->
                    <div class="teacher-stat-card classes-card" id="classes-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-calendar stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="upcoming-classes-count">{{upcoming_classes}}</div>
                            <div class="stat-label">UPCOMING CLASSES</div>
                            <div class="stat-status">• Today</div>
                            <div class="stat-updated" id="classes-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{last_updated}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshClassCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="classes-refresh-icon"></i>
                        </div>
                    </div>
                    {{/teacher_stats}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Courses Section -->
<div class="teacher-recent-courses-section">
    <div class="container-fluid">
        <div class="recent-courses-container">
            <div class="section-header">
                <h3 class="section-title">Recent Courses</h3>
                <p class="section-subtitle">Your most recently updated courses</p>
            </div>
            
            <div class="courses-list">
                {{#teacher_courses}}
                <div class="course-item">
                    <div class="course-info">
                        <div class="course-icon">
                            <i class="fa fa-book"></i>
                        </div>
                        <div class="course-details">
                            <div class="course-name">{{fullname}}</div>
                            <div class="course-shortname">{{shortname}}</div>
                            <div class="course-meta">
                                <span class="course-students">{{student_count}} students</span>
                                <span class="course-updated">Updated {{last_modified}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="course-actions">
                        <a href="{{url}}" class="btn btn-primary btn-sm">View Course</a>
                    </div>
                </div>
                {{/teacher_courses}}
                
                {{^teacher_courses}}
                <div class="no-courses-message">
                    <i class="fa fa-book"></i>
                    <p>No courses found. Create your first course to get started!</p>
                    <a href="{{config.wwwroot}}/course/edit.php" class="btn btn-primary">Create Course</a>
                </div>
                {{/teacher_courses}}
            </div>
        </div>
    </div>
</div>

<!-- Recent Students Section -->
<div class="teacher-recent-students-section">
    <div class="container-fluid">
        <div class="recent-students-container">
            <div class="section-header">
                <h3 class="section-title">Recent Students</h3>
                <p class="section-subtitle">Students from your courses</p>
            </div>
            
            <div class="students-list">
                {{#teacher_students}}
                <div class="student-item">
                    <div class="student-info">
                        <div class="student-icon">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="student-details">
                            <div class="student-name">{{name}}</div>
                            <div class="student-email">{{email}}</div>
                            <div class="student-meta">
                                <span class="student-courses">{{course_count}} courses</span>
                                <span class="student-last-access">Last seen {{last_access}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="student-actions">
                        <a href="{{profile_url}}" class="btn btn-outline-primary btn-sm">View Profile</a>
                    </div>
                </div>
                {{/teacher_students}}
                
                {{^teacher_students}}
                <div class="no-students-message">
                    <i class="fa fa-users"></i>
                    <p>No students found. Enroll students in your courses to see them here.</p>
                </div>
                {{/teacher_students}}
            </div>
        </div>
    </div>
</div>

<!-- Recent Assignments Section -->
<div class="teacher-recent-assignments-section">
    <div class="container-fluid">
        <div class="recent-assignments-container">
            <div class="section-header">
                <h3 class="section-title">Recent Assignments</h3>
                <p class="section-subtitle">Assignments that need your attention</p>
            </div>
            
            <div class="assignments-list">
                {{#teacher_assignments}}
                <div class="assignment-item">
                    <div class="assignment-info">
                        <div class="assignment-icon">
                            <i class="fa fa-tasks"></i>
                        </div>
                        <div class="assignment-details">
                            <div class="assignment-name">{{name}}</div>
                            <div class="assignment-course">{{course_name}}</div>
                            <div class="assignment-meta">
                                <span class="assignment-due">Due {{due_date}}</span>
                                <span class="assignment-submissions">{{submission_count}} submissions</span>
                                <span class="assignment-graded">{{graded_count}} graded</span>
                            </div>
                        </div>
                    </div>
                    <div class="assignment-status">
                        <span class="status-badge status-{{status}}">{{status}}</span>
                        <a href="{{url}}" class="btn btn-primary btn-sm">Grade</a>
                    </div>
                </div>
                {{/teacher_assignments}}
                
                {{^teacher_assignments}}
                <div class="no-assignments-message">
                    <i class="fa fa-tasks"></i>
                    <p>No assignments found. Create assignments in your courses to see them here.</p>
                </div>
                {{/teacher_assignments}}
            </div>
        </div>
    </div>
</div>

</div> <!-- End teacher-main-content -->

{{/teacher_dashboard}}

<!-- Regular Dashboard Content (fallback) -->
<div class="dashboard-content">
    <div id="region-main-box" class="d-print-block">
        <section id="region-main" class="d-print-block" aria-label="{{#str}}content{{/str}}">
            <div class="rui-course-content">
                {{{ output.main_content }}}
            </div>
        </section>
    </div>
</div>

{{> theme_remui/common_end}}

<script>
function toggleTeacherSidebar() {
    const sidebar = document.querySelector('.teacher-sidebar');
    sidebar.classList.toggle('sidebar-open');
}

// Close sidebar when clicking outside on mobile
document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.teacher-sidebar');
    const toggleButton = document.querySelector('.sidebar-toggle');
    
    if (window.innerWidth <= 768) {
        if (!sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
            sidebar.classList.remove('sidebar-open');
        }
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    const sidebar = document.querySelector('.teacher-sidebar');
    if (window.innerWidth > 768) {
        sidebar.classList.remove('sidebar-open');
    }
});

// Highlight active sidebar menu item based on current URL
document.addEventListener('DOMContentLoaded', function() {
    const currentUrl = window.location.href;
    const currentPath = window.location.pathname;
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    
    // Remove all active classes first
    sidebarItems.forEach(item => {
        item.classList.remove('active');
    });
    
    // Find and highlight the matching menu item
    sidebarItems.forEach(item => {
        const link = item.querySelector('.sidebar-link');
        if (link) {
            const href = link.getAttribute('href');
            
            // Skip empty or hash-only links
            if (!href || href === '#') {
                return;
            }
            
            // Check if current URL matches this link
            if (currentUrl === href || currentUrl.includes(href)) {
                item.classList.add('active');
            } else {
                // Try matching just the filename
                const linkPath = href.split('/').pop().split('?')[0];
                const currentFile = currentPath.split('/').pop().split('?')[0];
                
                if (linkPath && currentFile && linkPath === currentFile) {
                    item.classList.add('active');
                }
            }
        }
    });
    
    // If no item is active and we're on /my/ page, activate Teacher Dashboard
    const hasActive = document.querySelector('.sidebar-item.active');
    if (!hasActive && (currentPath.includes('/my/') || currentPath.endsWith('/my'))) {
        const dashboardItem = document.querySelector('.sidebar-item a[href*="/my/"]');
        if (dashboardItem) {
            dashboardItem.closest('.sidebar-item').classList.add('active');
        }
    }
});

// Real-time statistics update functions
function refreshCourseCount() {
    const refreshIcon = document.getElementById('courses-refresh-icon');
    const coursesCount = document.getElementById('total-courses-count');
    const coursesUpdated = document.getElementById('courses-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call (replace with actual API endpoint)
    setTimeout(() => {
        // Update the count (this would come from API)
        const currentValue = parseInt(coursesCount.textContent) || 0;
        coursesCount.textContent = currentValue;
        coursesUpdated.textContent = 'Last updated: ' + new Date().toLocaleString();
        
        // Remove loading state
        refreshIcon.classList.remove('fa-spin');
        
        // Show success feedback
        showUpdateFeedback('courses-card', 'success');
    }, 1000);
}

function refreshStudentCount() {
    const refreshIcon = document.getElementById('students-refresh-icon');
    const studentsCount = document.getElementById('total-students-count');
    const studentsUpdated = document.getElementById('students-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(studentsCount.textContent) || 0;
        studentsCount.textContent = currentValue;
        studentsUpdated.textContent = 'Last updated: ' + new Date().toLocaleString();
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('students-card', 'success');
    }, 1000);
}

function refreshAssignmentCount() {
    const refreshIcon = document.getElementById('assignments-refresh-icon');
    const assignmentsCount = document.getElementById('pending-assignments-count');
    const assignmentsUpdated = document.getElementById('assignments-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(assignmentsCount.textContent) || 0;
        assignmentsCount.textContent = currentValue;
        assignmentsUpdated.textContent = 'Last updated: ' + new Date().toLocaleString();
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('assignments-card', 'success');
    }, 1000);
}

function refreshClassCount() {
    const refreshIcon = document.getElementById('classes-refresh-icon');
    const classesCount = document.getElementById('upcoming-classes-count');
    const classesUpdated = document.getElementById('classes-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(classesCount.textContent) || 0;
        classesCount.textContent = currentValue;
        classesUpdated.textContent = 'Last updated: ' + new Date().toLocaleString();
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('classes-card', 'success');
    }, 1000);
}

function showUpdateFeedback(cardId, type) {
    const card = document.getElementById(cardId);
    const feedback = document.createElement('div');
    feedback.className = `update-feedback ${type}`;
    feedback.textContent = type === 'success' ? '✓ Updated' : '✗ Error';
    feedback.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: ${type === 'success' ? '#4CAF50' : '#f44336'};
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
    `;
    
    card.style.position = 'relative';
    card.appendChild(feedback);
    
    // Fade in
    setTimeout(() => feedback.style.opacity = '1', 10);
    
    // Fade out and remove
    setTimeout(() => {
        feedback.style.opacity = '0';
        setTimeout(() => card.removeChild(feedback), 300);
    }, 2000);
}

// Auto-refresh every 30 seconds
setInterval(refreshCourseCount, 30000);
setInterval(refreshStudentCount, 30000);
setInterval(refreshAssignmentCount, 30000);
setInterval(refreshClassCount, 30000);
</script>
</div> <!-- End teacher-dashboard-wrapper -->
