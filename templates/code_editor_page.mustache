{{!
    Code Editor Page Template for remui_kids theme
    
    This template embeds the Judge0 IDE from the local ide-master directory.
}}

<!-- Include Elementary Sidebar -->
{{> theme_remui_kids/elementary_sidebar}}

<div class="code-editor-page-content">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fa fa-code"></i>
            {{page_title}}
        </h1>
        <p class="page-subtitle">{{page_subtitle}}</p>
    </div>

    <!-- Judge0 IDE Container -->
    <div class="ide-container">
        <div class="ide-wrapper">
            <!-- IDE Navigation Bar -->
            <div class="ide-navbar">
                <div class="ide-nav-left">
                    <div class="ide-logo">
                        <i class="fa fa-code"></i>
                        <span>Judge0 IDE</span>
                    </div>
                </div>
                <div class="ide-nav-center">
                    <div class="ide-controls">
                        <button class="ide-btn" id="run-code-btn" title="Run Code (Ctrl+Enter)">
                            <i class="fa fa-play"></i>
                            <span>Run</span>
                        </button>
                        <button class="ide-btn" id="save-code-btn" title="Save Code">
                            <i class="fa fa-save"></i>
                            <span>Save</span>
                        </button>
                        <button class="ide-btn" id="theme-toggle-btn" title="Toggle Theme">
                            <i class="fa fa-moon-o"></i>
                            <span>Theme</span>
                        </button>
                    </div>
                </div>
                <div class="ide-nav-right">
                    <div class="ide-status">
                        <i class="fa fa-circle status-indicator" id="status-indicator"></i>
                        <span id="status-text">Ready</span>
                    </div>
                </div>
            </div>

            <!-- IDE Content Area -->
            <div class="ide-content">
                <iframe 
                    id="judge0-ide-frame" 
                    src="{{ide_base_url}}/embed-simple.html" 
                    frameborder="0"
                    allowfullscreen
                    title="Judge0 IDE">
                </iframe>
            </div>

            <!-- IDE Footer -->
            <div class="ide-footer">
                <div class="ide-info">
                    <span class="ide-info-item">
                        <i class="fa fa-language"></i>
                        <span id="current-language">Select Language</span>
                    </span>
                    <span class="ide-info-item">
                        <i class="fa fa-clock-o"></i>
                        <span id="execution-time">--</span>
                    </span>
                    <span class="ide-info-item">
                        <i class="fa fa-file-code-o"></i>
                        <span id="code-lines">0 lines</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- IDE Instructions -->
    <div class="ide-instructions">
        <div class="instruction-card">
            <div class="instruction-icon">
                <i class="fa fa-lightbulb-o"></i>
            </div>
            <div class="instruction-content">
                <h3>Getting Started</h3>
                <p>Select a programming language from the dropdown, write your code, and click "Run Code" to execute it. The IDE supports 60+ programming languages including Python, JavaScript, Java, C++, and more.</p>
            </div>
        </div>
        
        <div class="instruction-card">
            <div class="instruction-icon">
                <i class="fa fa-keyboard-o"></i>
            </div>
            <div class="instruction-content">
                <h3>Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>Ctrl+Enter</strong> - Run code</li>
                    <li><strong>Ctrl+S</strong> - Save code</li>
                    <li><strong>Ctrl+/</strong> - Toggle comment</li>
                    <li><strong>Ctrl+Z</strong> - Undo</li>
                    <li><strong>Ctrl+Y</strong> - Redo</li>
                </ul>
            </div>
        </div>
        
        <div class="instruction-card">
            <div class="instruction-icon">
                <i class="fa fa-rocket"></i>
            </div>
            <div class="instruction-content">
                <h3>Features</h3>
                <ul>
                    <li>Syntax highlighting for all languages</li>
                    <li>Code execution with real-time output</li>
                    <li>Multiple themes (Light, Dark, Monokai)</li>
                    <li>File management and saving</li>
                    <li>Compiler options and command line arguments</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Code Editor Styles -->
<style>
    .code-editor-page-content {
        padding: 30px;
        min-height: 100vh;
        background: #f8f9fa;
    }
    
    .page-header {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 25px;
        text-align: center;
    }
    
    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }
    
    .page-title i {
        color: #667eea;
    }
    
    .page-subtitle {
        font-size: 1.1rem;
        color: #6c757d;
        margin: 0;
    }
    
    .ide-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        overflow: hidden;
        margin-bottom: 25px;
    }
    
    .ide-wrapper {
        display: flex;
        flex-direction: column;
        height: 700px;
    }
    
    .ide-navbar {
        background: #2c3e50;
        color: white;
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #34495e;
    }
    
    .ide-nav-left {
        display: flex;
        align-items: center;
    }
    
    .ide-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        font-size: 1.1rem;
    }
    
    .ide-logo i {
        color: #667eea;
        font-size: 1.2rem;
    }
    
    .ide-nav-center {
        display: flex;
        align-items: center;
    }
    
    .ide-controls {
        display: flex;
        gap: 10px;
    }
    
    .ide-btn {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    
    .ide-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
    }
    
    .ide-btn.primary {
        background: #667eea;
        border-color: #5a6fd8;
    }
    
    .ide-btn.primary:hover {
        background: #5a6fd8;
    }
    
    .ide-nav-right {
        display: flex;
        align-items: center;
    }
    
    .ide-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }
    
    .status-indicator {
        font-size: 0.7rem;
        color: #27ae60;
    }
    
    .status-indicator.running {
        color: #f39c12;
        animation: pulse 1s infinite;
    }
    
    .status-indicator.error {
        color: #e74c3c;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    .ide-content {
        flex: 1;
        position: relative;
    }
    
    #judge0-ide-frame {
        width: 100%;
        height: 100%;
        border: none;
        background: white;
    }
    
    .ide-footer {
        background: #34495e;
        color: white;
        padding: 10px 20px;
        border-top: 1px solid #2c3e50;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .ide-info {
        display: flex;
        gap: 20px;
    }
    
    .ide-info-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.85rem;
    }
    
    .ide-info-item i {
        color: #667eea;
        width: 14px;
        text-align: center;
    }
    
    .ide-instructions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .instruction-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        display: flex;
        gap: 20px;
        transition: transform 0.3s ease;
    }
    
    .instruction-card:hover {
        transform: translateY(-3px);
    }
    
    .instruction-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .instruction-content h3 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.2rem;
    }
    
    .instruction-content p {
        color: #6c757d;
        line-height: 1.6;
        margin-bottom: 10px;
    }
    
    .instruction-content ul {
        color: #6c757d;
        margin: 0;
        padding-left: 20px;
    }
    
    .instruction-content li {
        margin-bottom: 5px;
        line-height: 1.4;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .code-editor-page-content {
            padding: 15px;
        }
        
        .page-title {
            font-size: 2rem;
        }
        
        .ide-wrapper {
            height: 600px;
        }
        
        .ide-navbar {
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }
        
        .ide-controls {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .ide-info {
            flex-direction: column;
            gap: 10px;
        }
        
        .instruction-card {
            flex-direction: column;
            text-align: center;
        }
    }
</style>

<!-- Code Editor JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const iframe = document.getElementById('judge0-ide-frame');
    const runBtn = document.getElementById('run-code-btn');
    const saveBtn = document.getElementById('save-code-btn');
    const themeBtn = document.getElementById('theme-toggle-btn');
    const statusIndicator = document.getElementById('status-indicator');
    const statusText = document.getElementById('status-text');
    const currentLanguage = document.getElementById('current-language');
    const executionTime = document.getElementById('execution-time');
    const codeLines = document.getElementById('code-lines');
    
    let isDarkTheme = false;
    
    // Update status
    function updateStatus(status, text) {
        statusIndicator.className = `fa fa-circle status-indicator ${status}`;
        statusText.textContent = text;
    }
    
    // Theme toggle
    themeBtn.addEventListener('click', function() {
        isDarkTheme = !isDarkTheme;
        const icon = themeBtn.querySelector('i');
        const text = themeBtn.querySelector('span');
        
        if (isDarkTheme) {
            icon.className = 'fa fa-sun-o';
            text.textContent = 'Light';
        } else {
            icon.className = 'fa fa-moon-o';
            text.textContent = 'Dark';
        }
        
        // Send theme change to iframe
        if (iframe.contentWindow) {
            iframe.contentWindow.postMessage({
                action: 'theme',
                theme: isDarkTheme ? 'dark' : 'light'
            }, '*');
        }
    });
    
    // Run code button
    runBtn.addEventListener('click', function() {
        updateStatus('running', 'Running...');
        
        if (iframe.contentWindow) {
            iframe.contentWindow.postMessage({action: 'run'}, '*');
        }
        
        // Reset status after 5 seconds
        setTimeout(() => {
            updateStatus('', 'Ready');
        }, 5000);
    });
    
    // Save code button
    saveBtn.addEventListener('click', function() {
        if (iframe.contentWindow) {
            iframe.contentWindow.postMessage({action: 'save'}, '*');
        }
        
        // Show success message
        const originalText = saveBtn.querySelector('span').textContent;
        saveBtn.querySelector('span').textContent = 'Saved!';
        setTimeout(() => {
            saveBtn.querySelector('span').textContent = originalText;
        }, 2000);
    });
    
    // Listen for messages from iframe
    window.addEventListener('message', function(event) {
        if (event.data && typeof event.data === 'object') {
            if (event.data.event === 'initialised') {
                updateStatus('', 'Ready');
                console.log('Judge0 IDE initialized');
            } else if (event.data.event === 'running') {
                updateStatus('running', 'Running...');
            } else if (event.data.event === 'finished') {
                updateStatus('', 'Completed');
                if (event.data.time) {
                    executionTime.textContent = `${event.data.time}ms`;
                }
            } else if (event.data.event === 'error') {
                updateStatus('error', 'Error');
            } else if (event.data.language) {
                currentLanguage.textContent = event.data.language;
            } else if (event.data.lines) {
                codeLines.textContent = `${event.data.lines} lines`;
            }
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            e.preventDefault();
            runBtn.click();
        } else if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            saveBtn.click();
        }
    });
    
    // Initialize
    updateStatus('', 'Loading...');
});
</script>