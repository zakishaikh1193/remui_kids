{{!
    Teacher Dashboard Template for remui_kids theme
    
    This template provides a teacher dashboard interface with course management,
    student tracking, and assignment monitoring capabilities.
}}

{{> theme_remui_kids/common_start}}

{{#teacher_dashboard}}
<!-- Full Screen Teacher Dashboard Wrapper -->
<div class="teacher-dashboard-wrapper">
    <!-- Mobile Sidebar Toggle Button -->
    <button class="sidebar-toggle" onclick="toggleTeacherSidebar()">
        <i class="fa fa-bars"></i>
    </button>

<!-- Teacher Dashboard Header -->


<!-- Teacher Sidebar Navigation -->
<div class="teacher-sidebar">
    <div class="sidebar-content">
        <!-- DASHBOARD Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">DASHBOARD</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/my/" class="sidebar-link">
                        <i class="fa fa-th-large sidebar-icon"></i>
                        <span class="sidebar-text">Teacher Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php" class="sidebar-link">
                        <i class="fa fa-book sidebar-icon"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/grade/report/grader/index.php" class="sidebar-link">
                        <i class="fa fa-graduation-cap sidebar-icon"></i>
                        <span class="sidebar-text">Gradebook</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/mod/assign/index.php" class="sidebar-link">
                        <i class="fa fa-tasks sidebar-icon"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- COURSES Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">COURSES</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php" class="sidebar-link">
                        <i class="fa fa-book sidebar-icon"></i>
                        <span class="sidebar-text">All Courses</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/edit.php" class="sidebar-link">
                        <i class="fa fa-plus sidebar-icon"></i>
                        <span class="sidebar-text">Create Course</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/course/index.php?categoryid=0" class="sidebar-link">
                        <i class="fa fa-folder sidebar-icon"></i>
                        <span class="sidebar-text">Course Categories</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- STUDENTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">STUDENTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/teacher/students.php" class="sidebar-link">
                        <i class="fa fa-users sidebar-icon"></i>
                        <span class="sidebar-text">All Students</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/enrol/users.php" class="sidebar-link">
                        <i class="fa fa-user-plus sidebar-icon"></i>
                        <span class="sidebar-text">Enroll Students</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/progress/index.php" class="sidebar-link">
                        <i class="fa fa-chart-line sidebar-icon"></i>
                        <span class="sidebar-text">Progress Reports</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- ASSESSMENTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">ASSESSMENTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/mod/assign/index.php" class="sidebar-link">
                        <i class="fa fa-tasks sidebar-icon"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/teacher/quizzes.php" class="sidebar-link">
                        <i class="fa fa-question-circle sidebar-icon"></i>
                        <span class="sidebar-text">Quizzes</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/teacher/competencies.php" class="sidebar-link">
                        <i class="fa fa-sitemap sidebar-icon"></i>
                        <span class="sidebar-text">Competencies</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/grade/report/grader/index.php" class="sidebar-link">
                        <i class="fa fa-star sidebar-icon"></i>
                        <span class="sidebar-text">Grading</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- QUESTIONS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">QUESTIONS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/pages/questions_unified.php" class="sidebar-link">
                        <i class="fa fa-question-circle sidebar-icon"></i>
                        <span class="sidebar-text">Questions Management</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- REPORTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">REPORTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/log/index.php" class="sidebar-link">
                        <i class="fa fa-chart-bar sidebar-icon"></i>
                        <span class="sidebar-text">Activity Logs</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/outline/index.php" class="sidebar-link">
                        <i class="fa fa-file-alt sidebar-icon"></i>
                        <span class="sidebar-text">Course Reports</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/report/progress/index.php" class="sidebar-link">
                        <i class="fa fa-chart-line sidebar-icon"></i>
                        <span class="sidebar-text">Progress Tracking</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Main Content Area with Sidebar -->
<div class="teacher-main-content">
    <div class="container-fluid">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="header-content title-chip">
                <h1 class="dashboard-title">Dashboard</h1>
                <p class="dashboard-subtitle">Teacher Overview</p>
            </div>
            <div class="header-actions">
                <span class="dashboard-badge">Teacher</span>
            </div>
        </div>

        <!-- Statistics Cards Grid -->
        <div class="stats-grid">
            {{#teacher_stats}}
            <!-- Total Courses Card -->
            <div class="stat-card courses-card" id="courses-card">
                <div class="stat-card-header">
                    <div class="stat-icon">
                        <i class="fa fa-file-text"></i>
                    </div>
                    
                </div>
                <div class="stat-card-content">
                    <div class="stat-number" id="total-courses-count">{{total_courses}}</div>
                    <div class="stat-label">TOTAL COURSES</div>
                </div>
            </div>
            
            <!-- Total Students Card -->
            <div class="stat-card students-card" id="students-card">
                <div class="stat-card-header">
                    <div class="stat-icon">
                        <i class="fa fa-user-friends"></i>
                    </div>
                    
                </div>
                <div class="stat-card-content">
                    <div class="stat-number" id="total-students-count">{{total_students}}</div>
                    <div class="stat-label">TOTAL STUDENTS</div>
                </div>
            </div>
            
            <!-- Assignments Card -->
            <div class="stat-card assignments-card" id="assignments-card">
                <div class="stat-card-header">
                    <div class="stat-icon">
                        <i class="fa fa-tasks"></i>
                    </div>
                    
                </div>
                <div class="stat-card-content">
                    <div class="stat-number" id="pending-assignments-count">{{pending_assignments}}</div>
                    <div class="stat-label">TOTAL ASSIGNMENTS</div>
                </div>
            </div>
            
            <!-- Upcoming Classes Card -->
            <div class="stat-card classes-card" id="classes-card">
                <div class="stat-card-header">
                    <div class="stat-icon">
                        <i class="fa fa-calendar-alt"></i>
                    </div>
                    
                </div>
                <div class="stat-card-content">
                    <div class="stat-number" id="upcoming-classes-count">{{upcoming_classes}}</div>
                    <div class="stat-label">UPCOMING CLASSES</div>
                </div>
            </div>
            
            <!-- Total Quizzes Card -->
            <div class="stat-card quizzes-card" id="quizzes-card">
                <div class="stat-card-header">
                    <div class="stat-icon">
                        <i class="fa fa-question-circle"></i>
                    </div>
                    
                </div>
                <div class="stat-card-content">
                    <div class="stat-number" id="total-quizzes-count">{{total_quizzes}}</div>
                    <div class="stat-label">TOTAL QUIZZES</div>
                </div>
            </div>
            
            {{/teacher_stats}}
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Recent Student Activity -->
            <div class="content-card activity-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-history"></i>
                        <span>Recent Student Activity</span>
                    </div>
                    
                </div>
                <div class="card-content">
                    <div class="activity-feed">
                        {{#recent_student_activity}}
                        <div class="activity-item">
                            <div class="activity-icon" style="background-color: {{color}};">
                                <i class="fa {{icon}}"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-header">
                                    <strong>{{student_name}}</strong>
                                    <span class="activity-type-badge">{{activity_type}}</span>
                                </div>
                                <div class="activity-details">
                                    {{activity_name}} <span class="text-muted">in</span> {{course_name}}
                                </div>
                                <div class="activity-time">
                                    <i class="fa fa-clock-o"></i> {{time}}
                                </div>
                            </div>
                        </div>
                        {{/recent_student_activity}}
                        {{^recent_student_activity}}
                        <div class="empty-state">
                            <i class="fa fa-inbox"></i>
                            <p>No recent student activity</p>
                        </div>
                        {{/recent_student_activity}}
                    </div>
                </div>
            </div>

            <!-- Course Overview -->
            <div class="content-card course-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-graduation-cap"></i>
                        <span>Course Overview</span>
                    </div>
                </div>
                <div class="card-content">
                    <div class="course-overview-list">
                        {{#course_overview}}
                        <div class="course-overview-item">
                            <div class="course-info">
                                <a href="{{url}}" class="course-link">
                                    <div class="course-title">{{name}}</div>
                                    <div class="course-shortname">{{shortname}}</div>
                                </a>
                            </div>
                            <div class="course-stats">
                                <div class="stat-item">
                                    <i class="fa fa-users"></i>
                                    <span>{{student_count}}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fa fa-tasks"></i>
                                    <span>{{activity_count}}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fa fa-file-text"></i>
                                    <span>{{assignment_count}}</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fa fa-star"></i>
                                    <span>{{quiz_count}}</span>
                                </div>
                            </div>
                        </div>
                        {{/course_overview}}
                        {{^course_overview}}
                        <div class="empty-state">
                            <i class="fa fa-book"></i>
                            <p>No courses found</p>
                        </div>
                        {{/course_overview}}
                    </div>
                </div>
            </div>

            <!-- Top Courses -->
            <div class="content-card top-courses-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-trophy"></i>
                        <span>Top Courses</span>
                    </div>
                </div>
                <div class="card-content">
                    <div class="top-courses-list">
                        {{#top_courses}}
                        <div class="course-item">
                            <div class="course-icon">
                                <i class="fa fa-book"></i>
                            </div>
                            <div class="course-info">
                                <div class="course-name">{{name}}</div>
                                <div class="course-enrollment">{{enrollment_count}} students • {{element_count}} elements</div>
                            </div>
                        </div>
                        {{/top_courses}}
                        {{^top_courses}}
                        <div class="empty-state">
                            <i class="fa fa-book"></i>
                            <p>No course data available</p>
                        </div>
                        {{/top_courses}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Content Grid -->
        <div class="secondary-grid">
            <!-- Student Enrollment -->
            <div class="content-card enrollment-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-users"></i>
                        <span>Student Enrollment</span>
                    </div>
                    <div class="card-actions">
                        
                        <button class="btn-link" onclick="addNewStudent()" title="Add Student">
                            <i class="fa fa-user-plus"></i>
                        </button>
                        <button class="btn-link" onclick="manageStudents()" title="Manage Students">
                            <i class="fa fa-users-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- Enhanced Enrollment Toolbar -->
                    <div class="enrollment-toolbar">
                        <div class="toolbar-left">
                            <div class="search-box">
                                <input type="text" id="student-search" placeholder="Search students..." class="form-control">
                                <i class="fa fa-search"></i>
                            </div>
                        </div>
                        <div class="toolbar-right">
                            <label class="switch-inline">
                                <input type="checkbox" id="only-managers-toggle" onchange="filterStudents()">
                                <span class="switch-label">Only Managers</span>
                            </label>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="enrollment-loading" class="loading-state" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>Loading students...</p>
                    </div>

                    <!-- Enhanced Student Table -->
                    <div class="enrollment-table-wrapper">
                        <table class="enrollment-table">
                            <thead>
                                <tr>
                                    <th class="avatar-col">User Pic</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Last Access</th>
                                    <th>Courses Not Yet Started</th>
                                    <th>Courses In Progress</th>
                                    <th>Enrolled Courses</th>
                                    <th>Finished Courses</th>
                                    <th class="actions-col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="student-table-body">
                                {{#teacher_students}}
                                <tr>
                                    <td class="avatar-col">
                                        <div class="student-avatar">
                                            <img src="{{avatar_url}}" alt="{{firstname}} {{lastname}}" onerror="this.style.display='none'" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="student-name">{{firstname}}</div>
                                    </td>
                                    <td>
                                        <div class="student-name">{{lastname}}</div>
                                    </td>
                                    <td>
                                        <div class="last-access">
                                            <span class="access-time">{{last_access}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="course-count">
                                            <span class="badge courses-not-started">{{courses_not_started}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="course-count">
                                            <span class="badge courses-in-progress">{{courses_in_progress}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="course-count">
                                            <span class="badge enrolled-courses">{{enrolled_courses}}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="course-count">
                                            <span class="badge finished-courses">{{finished_courses}}</span>
                                        </div>
                                    </td>
                                    <td class="actions-col">
                                        <a href="{{profile_url}}" class="btn-action" title="View Profile">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {{/teacher_students}}
                                {{^teacher_students}}
                                <tr>
                                    <td colspan="9" class="empty-state">
                                        <i class="fa fa-users"></i>
                                        <p>No students found</p>
                                    </td>
                                </tr>
                                {{/teacher_students}}
                            </tbody>
                        </table>
                    </div>

                    <!-- No Data State -->
                    <div id="no-students-message" class="no-data-state" style="display: none;">
                        <div class="no-data-icon">
                            <i class="fa fa-users"></i>
                        </div>
                        <h6>No Students Found</h6>
                        <p id="no-data-message-text">Enroll students in your courses to see them here.</p>
                    </div>

                    <!-- Enhanced Pagination -->
                    <div id="enrollment-pagination" class="enrollment-pagination" style="display: none;">
                        <div class="pagination-info">
                            <span id="pagination-info-text">Showing 0 of 0 students</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="btn-pagination" id="prev-page" onclick="changePage(-1)" disabled>
                                <i class="fa fa-chevron-left"></i>
                            </button>
                            <div id="page-numbers" class="page-numbers">
                                <!-- Page numbers will be dynamically generated -->
                            </div>
                            <button class="btn-pagination" id="next-page" onclick="changePage(1)">
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Content Grid -->
        <div class="additional-grid">
            <!-- Recent Courses -->
            <div class="content-card courses-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-book"></i>
                        <span>Recent Courses</span>
                    </div>
                    <a href="{{config.wwwroot}}/course/index.php" class="btn-link">View All</a>
                </div>
                <div class="card-content">
                    <div class="courses-list">
                        {{#teacher_courses}}
                        <div class="course-item">
                            <div class="course-icon">
                                <i class="fa fa-book"></i>
                            </div>
                            <div class="course-details">
                                <div class="course-name">{{fullname}}</div>
                                <div class="course-shortname">{{shortname}}</div>
                                <div class="course-meta">
                                    <span class="course-students">{{student_count}} students</span>
                                    <span class="course-updated">Updated {{last_modified}}</span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <a href="{{url}}" class="btn-primary">View Course</a>
                            </div>
                        </div>
                        {{/teacher_courses}}
                        {{^teacher_courses}}
                        <div class="empty-state">
                            <i class="fa fa-book"></i>
                            <p>No courses found. Create your first course to get started!</p>
                            <a href="{{config.wwwroot}}/course/edit.php" class="btn-primary">Create Course</a>
                        </div>
                        {{/teacher_courses}}
                    </div>
                </div>
            </div>

            <!-- Class Performance Overview -->
            <div class="content-card performance-card-pro">
                <div class="card-header-pro">
                    <h3 class="card-title-pro">
                        <i class="fa fa-chart-line"></i>
                        Class Performance Overview
                    </h3>
                    <a href="{{config.wwwroot}}/grade/report/grader/index.php" class="btn-view-gradebook">
                        View Gradebook
                    </a>
                </div>
                <div class="card-content-pro">
                    <div class="metrics-grid-pro">
                        {{#class_performance}}
                        <div class="metric-box-pro">
                            <div class="metric-icon-pro">
                                <i class="fa {{icon}}"></i>
                            </div>
                            <div class="metric-info-pro">
                                <div class="metric-label-pro">{{metric}}</div>
                                <div class="metric-value-pro">{{value}}</div>
                                <div class="metric-trend-pro">
                                    {{#trend}}
                                    {{trend_label}}
                                    {{/trend}}
                                    {{^trend}}
                                    {{trend_label}}
                                    {{/trend}}
                                </div>
                            </div>
                        </div>
                        {{/class_performance}}
                        {{^class_performance}}
                        <div class="empty-state-pro">
                            <i class="fa fa-chart-line"></i>
                            <p>No performance data available. Grade assignments to see analytics.</p>
                        </div>
                        {{/class_performance}}
                    </div>
                </div>
            </div>

            <!-- Assignment Analytics -->
            <div class="content-card analytics-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-clipboard-list"></i>
                        <span>Assignment Analytics</span>
                    </div>
                    <a href="{{config.wwwroot}}/mod/assign/index.php" class="btn-link">View All</a>
                </div>
                <div class="card-content">
                    <div class="analytics-list">
                        {{#assignment_analytics}}
                        <div class="analytics-item">
                            <div class="analytics-header">
                                <div class="analytics-title">
                                    <h4>{{name}}</h4>
                                    <span class="analytics-course">{{course_shortname}}</span>
                                </div>
                                <span class="analytics-status status-{{status_class}}">{{status}}</span>
                            </div>
                            <div class="analytics-stats">
                                <div class="stat-group">
                                    <div class="stat-item">
                                        <i class="fa fa-users"></i>
                                        <span>{{total_students}} students</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fa fa-paper-plane"></i>
                                        <span>{{submitted_count}} submitted</span>
                                    </div>
                                    <div class="stat-item">
                                        <i class="fa fa-check"></i>
                                        <span>{{graded_count}} graded</span>
                                    </div>
                                </div>
                                <div class="progress-group">
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-label">
                                            <span>Submission Rate: {{submission_rate}}%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{submission_rate}}%; background-color: #10b981;"></div>
                                        </div>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-label">
                                            <span>Grading Progress: {{grading_progress}}%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{grading_progress}}%; background-color: #3b82f6;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="analytics-actions">
                                    <span class="avg-grade">Avg: {{avg_grade}}%</span>
                                    {{#pending_grading}}
                                    <span class="pending-badge">{{pending_grading}} pending</span>
                                    {{/pending_grading}}
                                    <a href="{{url}}" class="btn-primary">View Details</a>
                                </div>
                            </div>
                        </div>
                        {{/assignment_analytics}}
                        {{^assignment_analytics}}
                        <div class="empty-state">
                            <i class="fa fa-clipboard-list"></i>
                            <p>No assignment analytics available. Create and grade assignments to see data.</p>
                        </div>
                        {{/assignment_analytics}}
                    </div>
                </div>
            </div>

            <!-- Student Questions -->
            <div class="content-card questions-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-question-circle"></i>
                        <span>Student Questions</span>
                    </div>
                    <div class="card-actions">
                        <button class="btn-link" onclick="viewAllQuestions()" title="View All Questions">
                            <i class="fa fa-list"></i>
                        </button>
                        <button class="btn-link" onclick="openMoodleMessaging()" title="Open Moodle Messaging">
                            <i class="fa fa-envelope"></i>
                        </button>
                        <button class="btn-link" onclick="openMoodleForums()" title="Open Moodle Forums">
                            <i class="fa fa-comments"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- Integration Status -->
                    <div class="integration-status">
                        <div class="integration-content">
                            <i class="fa fa-check-circle"></i>
                            <span>Integrated with Moodle Messaging & Forums</span>
                        </div>
                        
                    </div>
                    
                    <!-- Question Filters -->
                    <div class="questions-toolbar">
                        <div class="filter-group">
                            <label class="filter-label">Sort By:</label>
                            <select id="question-sort" class="filter-select" onchange="filterQuestions()">
                                <option value="latest">Latest</option>
                                <option value="oldest">Oldest</option>
                                <option value="most_replied">Most Replied</option>
                                <option value="unanswered">Unanswered</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Filter:</label>
                            <select id="question-filter" class="filter-select" onchange="filterQuestions()">
                                <option value="all">All</option>
                                <option value="grade_9">Grade 9</option>
                                <option value="grade_10">Grade 10</option>
                                <option value="grade_11">Grade 11</option>
                                <option value="grade_12">Grade 12</option>
                                <option value="mathematics">Mathematics</option>
                                <option value="science">Science</option>
                                <option value="english">English</option>
                            </select>
                        </div>
                    </div>

                    <!-- Questions List -->
                    <div class="questions-list">
                        {{#student_questions}}
                        <div class="question-item" data-grade="{{grade}}" data-course="{{course}}">
                            <div class="question-header">
                                <h4 class="question-title">{{title}}</h4>
                                <div class="question-meta">
                                    <span class="question-grade">{{grade}}</span>
                                    <span class="question-course">{{course}}</span>
                                </div>
                            </div>
                            <div class="question-content">
                                <p class="question-text">{{content}}</p>
                                <div class="question-student">
                                    <span class="student-name">{{student_name}}</span>
                                    <span class="question-date">{{date}}</span>
                                </div>
                            </div>
                            <div class="question-status">
                                <span class="status-badge {{status_class}}">{{status}}</span>
                                <div class="question-stats">
                                    <span class="upvotes">{{upvotes}} UPVOTES</span>
                                    <span class="replies">{{replies}} REPLIES</span>
                                </div>
                            </div>
                            <div class="question-actions">
                                <button class="btn-action" onclick="answerQuestion({{id}})" title="Answer">
                                    <i class="fa fa-reply"></i>
                                </button>
                                <button class="btn-action" onclick="startVideoCall({{id}})" title="Video Call">
                                    <i class="fa fa-video"></i>
                                </button>
                                <button class="btn-action" onclick="startAudioCall({{id}})" title="Audio Call">
                                    <i class="fa fa-phone"></i>
                                </button>
                                <button class="btn-action" onclick="startChat({{id}})" title="Chat">
                                    <i class="fa fa-comments"></i>
                                </button>
                                <button class="btn-action" onclick="groupCall({{id}})" title="Group Call">
                                    <i class="fa fa-users"></i>
                                </button>
                            </div>
                        </div>
                        {{/student_questions}}
                        {{^student_questions}}
                        <div class="empty-state">
                            <i class="fa fa-question-circle"></i>
                            <p>No questions available</p>
                        </div>
                        {{/student_questions}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Insights and Calendar Section -->
        <div class="insights-calendar-grid">
            <!-- Student Insights -->
            <div class="content-card insights-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-lightbulb"></i>
                        <span>Student Insights</span>
                    </div>
                    <a href="{{config.wwwroot}}/report/progress/index.php" class="btn-link">View Reports</a>
                </div>
                <div class="card-content">
                    <div class="insights-list">
                        {{#student_insights}}
                        <div class="insight-item" onclick="window.location.href='{{config.wwwroot}}/theme/remui_kids/pages/student_overview.php?id={{id}}'" style="cursor: pointer;">
                            <div class="insight-student">
                                <img src="{{avatar_url}}" alt="{{student_name}}" class="insight-avatar" onerror="this.style.display='none'">
                                <div class="insight-info">
                                    <div class="insight-name">{{student_name}}</div>
                                    <div class="insight-category {{category_class}}">{{category}}</div>
                                </div>
                            </div>
                            <div class="insight-metrics">
                                <div class="insight-grade">{{avg_grade}}%</div>
                                <div class="insight-activities">{{completed_activities}} activities</div>
                                <div class="insight-last-active">{{last_activity}}</div>
                            </div>
                            <div class="insight-message">
                                <i class="fa fa-info-circle"></i>
                                <span>{{insight}}</span>
                            </div>
                            <div class="insight-actions">
                                <a href="{{profile_url}}" class="btn-outline">View Profile</a>
                            </div>
                        </div>
                        {{/student_insights}}
                        {{^student_insights}}
                        <div class="empty-state">
                            <i class="fa fa-lightbulb"></i>
                            <p>No student insights available. Grade assignments to generate insights.</p>
                        </div>
                        {{/student_insights}}
                    </div>
                </div>
            </div>

            <!-- Calendar Events -->
            <div class="content-card calendar-card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fa fa-calendar-alt"></i>
                        <span>Upcoming Events</span>
                    </div>
                    <a href="{{config.wwwroot}}/calendar/view.php" class="btn-link">View Calendar</a>
                </div>
                <div class="card-content">
                    <div class="calendar-list">
                        {{#calendar_events}}
                        <div class="calendar-event {{#is_urgent}}urgent{{/is_urgent}} {{#is_today}}today{{/is_today}}">
                            <div class="event-date-box">
                                <div class="month">{{month_name}}</div>
                                <div class="day">{{day_num}}</div>
                                <div class="weekday">{{day_name}}</div>
                            </div>
                            <div class="event-details">
                                <h4 class="event-name">{{name}}</h4>
                                <div class="event-meta">
                                    <span class="event-type" style="background-color: {{event_color}};">
                                        <i class="fa {{event_icon}}"></i>
                                        {{event_type}}
                                    </span>
                                    <span class="event-course">{{course_name}}</span>
                                </div>
                                <p class="event-description">{{description}}</p>
                                <div class="event-time">
                                    <i class="fa fa-clock"></i>
                                    {{event_time}} • {{time_until}}
                                </div>
                            </div>
                        </div>
                        {{/calendar_events}}
                        {{^calendar_events}}
                        <div class="empty-state">
                            <i class="fa fa-calendar-alt"></i>
                            <p>No upcoming events in the next 30 days</p>
                        </div>
                        {{/calendar_events}}
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- End container-fluid -->
</div> <!-- End teacher-main-content -->

{{/teacher_dashboard}}

<!-- Regular Dashboard Content (fallback) -->
<div class="dashboard-content">
    <div id="region-main-box" class="d-print-block">
        <section id="region-main" class="d-print-block" aria-label="{{#str}}content{{/str}}">
            <div class="rui-course-content">
                {{{ output.main_content }}}
            </div>
        </section>
    </div>
</div>

{{> theme_remui/common_end}}

<!-- All styling moved to teacher_dashboard.scss -->

<script>
/* Dashboard Card Styles - REMOVED - Now in teacher_dashboard.scss */
.dashboard-card {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    margin-bottom: 20px;
    border: none;
}

.dashboard-card .card-header {
    background-color: transparent;
    border-bottom: 1px solid #f0f0f0;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.dashboard-card .card-title {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.dashboard-card .card-body {
    padding: 20px;
}

/* Stat Card Styles */
.teacher-stat-card {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    padding: 20px;
    margin-bottom: 20px;
    position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
}

.teacher-stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.stat-icon-container {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
}

.courses-card .stat-icon-container {
    background-color: rgba(54, 162, 235, 0.1);
    color: #36a2eb;
}

.students-card .stat-icon-container {
    background-color: rgba(255, 99, 132, 0.1);
    color: #ff6384;
}

.assignments-card .stat-icon-container {
    background-color: rgba(255, 206, 86, 0.1);
    color: #ffce56;
}

.classes-card .stat-icon-container {
    background-color: rgba(75, 192, 192, 0.1);
    color: #4bc0c0;
}

.stat-number {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
}

.stat-change {
    font-size: 12px;
    font-weight: 600;
}

.stat-change.positive {
    color: #28a745;
}

.stat-change.negative {
    color: #dc3545;
}

/* Progress Styles */
.progress-container {
    margin-bottom: 15px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
}

.progress-label {
    font-weight: 600;
}

.progress-value {
    font-weight: 700;
}

.progress {
    height: 10px;
    background-color: #f0f0f0;
    border-radius: 5px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    border-radius: 5px;
}

/* Top Lists Styles */
.top-students-list, .top-courses-list {
    margin-top: 10px;
}

.student-item, .course-item {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f0f0f0;
}

.student-item:last-child, .course-item:last-child {
    border-bottom: none;
}

.student-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    margin-right: 15px;
}

.student-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.course-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    color: #666;
}

.student-info, .course-info {
    flex: 1;
}

.student-name, .course-name {
    font-weight: 600;
    margin-bottom: 3px;
}

.student-score, .course-enrollment {
    font-size: 14px;
    color: #666;
}

/* Feedback Styles */
.feedback-overview {
    display: flex;
    flex-direction: column;
}

.rating-summary {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
}

.rating-number {
    font-size: 48px;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 5px;
}

.rating-stars {
    color: #ffc107;
    margin-bottom: 5px;
}

.rating-count {
    font-size: 14px;
    color: #666;
}

.rating-breakdown {
    margin-top: 15px;
}

.rating-bar {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.rating-label {
    width: 60px;
    font-size: 14px;
}

.rating-bar .progress {
    flex: 1;
    height: 8px;
    margin: 0 10px;
    background-color: #f0f0f0;
}

.rating-bar .progress-bar {
    background-color: #ffc107;
}

.rating-percentage {
    width: 40px;
    text-align: right;
    font-size: 14px;
}

.feedback-list {
    max-height: 300px;
    overflow-y: auto;
}

.feedback-item {
    padding: 15px 0;
    border-bottom: 1px solid #f0f0f0;
}

.feedback-item:last-child {
    border-bottom: none;
}

.feedback-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
}

.student-name {
    font-weight: 600;
}

.feedback-date {
    font-size: 14px;
    color: #666;
}

.feedback-rating {
    color: #ffc107;
    margin-bottom: 5px;
}

.feedback-comment {
    font-size: 14px;
    color: #333;
}

/* No Data Message Styles */
.no-data-message, .no-courses-message, .no-students-message, .no-assignments-message, .no-feedback-message {
    text-align: center;
    padding: 20px;
    color: #666;
}

.no-data-message i, .no-courses-message i, .no-students-message i, .no-assignments-message i, .no-feedback-message i {
    font-size: 48px;
    margin-bottom: 15px;
    color: #ddd;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .teacher-stats-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    
    .teacher-stat-card {
        width: 48%;
        margin-bottom: 15px;
    }
    
    .feedback-overview {
        flex-direction: column;
    }
    
    .rating-summary {
        margin-bottom: 20px;
    }
}
*/
</script>

<script>
// Teacher Dashboard JavaScript
function toggleTeacherSidebar() {
    const sidebar = document.querySelector('.teacher-sidebar');
    sidebar.classList.toggle('sidebar-open');
}

// Close sidebar when clicking outside on mobile
document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.teacher-sidebar');
    const toggleButton = document.querySelector('.sidebar-toggle');
    
    if (window.innerWidth <= 768) {
        if (!sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
            sidebar.classList.remove('sidebar-open');
        }
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    const sidebar = document.querySelector('.teacher-sidebar');
    if (window.innerWidth > 768) {
        sidebar.classList.remove('sidebar-open');
    }
});

// Highlight active sidebar menu item based on current URL
document.addEventListener('DOMContentLoaded', function() {
    const currentUrl = window.location.href;
    const currentPath = window.location.pathname;
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    
    // Remove all active classes first
    sidebarItems.forEach(item => {
        item.classList.remove('active');
    });
    
    // Find and highlight the matching menu item
    sidebarItems.forEach(item => {
        const link = item.querySelector('.sidebar-link');
        if (link) {
            const href = link.getAttribute('href');
            
            // Skip empty or hash-only links
            if (!href || href === '#') {
                return;
            }
            
            // Check if current URL matches this link
            if (currentUrl === href || currentUrl.includes(href)) {
                item.classList.add('active');
            } else {
                // Try matching just the filename
                const linkPath = href.split('/').pop().split('?')[0];
                const currentFile = currentPath.split('/').pop().split('?')[0];
                
                if (linkPath && currentFile && linkPath === currentFile) {
                    item.classList.add('active');
                }
            }
        }
    });
    
    // If no item is active and we're on /my/ page, activate Teacher Dashboard
    const hasActive = document.querySelector('.sidebar-item.active');
    if (!hasActive && (currentPath.includes('/my/') || currentPath.endsWith('/my'))) {
        const dashboardItem = document.querySelector('.sidebar-item a[href*="/my/"]');
        if (dashboardItem) {
            dashboardItem.closest('.sidebar-item').classList.add('active');
        }
    }
    
    // Initialize Charts
    // Charts removed - now using real activity feed and course overview
    // initializeCharts();
});

// Real-time statistics update functions
function refreshCourseCount() {
    const refreshIcon = document.getElementById('courses-refresh-icon');
    const coursesCount = document.getElementById('total-courses-count');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call (replace with actual API endpoint)
    setTimeout(() => {
        // Update the count (this would come from API)
        const currentValue = parseInt(coursesCount.textContent) || 0;
        coursesCount.textContent = currentValue;
        
        // Remove loading state
        refreshIcon.classList.remove('fa-spin');
        
        // Show success feedback
        showUpdateFeedback('courses-card', 'success');
    }, 1000);
}

function refreshStudentCount() {
    const refreshIcon = document.getElementById('students-refresh-icon');
    const studentsCount = document.getElementById('total-students-count');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(studentsCount.textContent) || 0;
        studentsCount.textContent = currentValue;
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('students-card', 'success');
    }, 1000);
}

function refreshAssignmentCount() {
    const refreshIcon = document.getElementById('assignments-refresh-icon');
    const assignmentsCount = document.getElementById('pending-assignments-count');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(assignmentsCount.textContent) || 0;
        assignmentsCount.textContent = currentValue;
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('assignments-card', 'success');
    }, 1000);
}

function refreshClassCount() {
    const refreshIcon = document.getElementById('classes-refresh-icon');
    const classesCount = document.getElementById('upcoming-classes-count');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Simulate API call
    setTimeout(() => {
        const currentValue = parseInt(classesCount.textContent) || 0;
        classesCount.textContent = currentValue;
        
        refreshIcon.classList.remove('fa-spin');
        showUpdateFeedback('classes-card', 'success');
    }, 1000);
}

function showUpdateFeedback(cardId, type) {
    const card = document.getElementById(cardId);
    const feedback = document.createElement('div');
    feedback.className = `update-feedback ${type}`;
    feedback.textContent = type === 'success' ? '✓ Updated' : '✗ Error';
    feedback.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: ${type === 'success' ? '#4CAF50' : '#f44336'};
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
    `;
    
    card.style.position = 'relative';
    card.appendChild(feedback);
    
    // Fade in
    setTimeout(() => feedback.style.opacity = '1', 10);
    
    // Fade out and remove
    setTimeout(() => {
        feedback.style.opacity = '0';
        setTimeout(() => card.removeChild(feedback), 300);
    }, 2000);
}

// Initialize Charts
function initializeCharts() {
    // Performance Chart
    const performanceCtx = document.getElementById('performanceChart');
    if (performanceCtx) {
        // Try to use server-provided data
        let perfData = null;
        try {
            perfData = {{#performanceChart}}{{{performanceChart}}}{{/performanceChart}}{{^performanceChart}}null{{/performanceChart}};
            console.log('Performance Chart Data:', perfData);
        } catch (e) {
            console.log('Performance Chart Error:', e);
            perfData = null;
        }

        const labels = perfData && perfData.labels ? perfData.labels : ['Mathematics', 'Science', 'English', 'History', 'Art', 'Music'];
        const dataset = perfData && perfData.data ? perfData.data : [85, 78, 92, 88, 76, 82];
        const counts = perfData && perfData.counts ? perfData.counts : [30, 25, 28, 18, 20, 16];
        
        // Ensure we have meaningful data
        if (dataset.length === 0 || dataset.every(val => val === 0)) {
            dataset[0] = 85; dataset[1] = 78; dataset[2] = 92; dataset[3] = 88; dataset[4] = 76; dataset[5] = 82;
        }

        new Chart(performanceCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Completion Rate (%)',
                    data: dataset,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const idx = context.dataIndex;
                                const rate = context.parsed.y;
                                const count = counts[idx] !== undefined ? counts[idx] : 'N/A';
                                return 'Completion: ' + rate + '% — ' + count + ' students';
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Completion Chart
    const completionCtx = document.getElementById('completionChart');
    if (completionCtx) {
        // Try to use server-provided completion summary
        let compSummary = null;
        try {
            compSummary = {{#completionSummary}}{{{completionSummary}}}{{/completionSummary}}{{^completionSummary}}null{{/completionSummary}};
            console.log('Completion Chart Data:', compSummary);
        } catch (e) {
            console.log('Completion Chart Error:', e);
            compSummary = null;
        }

        const labels = ['Completed', 'In Progress', 'Not Started'];
        const data = compSummary ? [compSummary.completed || 0, compSummary.inprogress || 0, compSummary.not_started || 0] : [65, 25, 10];
        
        // Ensure we have meaningful data
        const total = data.reduce((sum, val) => sum + val, 0);
        if (total === 0) {
            data[0] = 65; // Completed
            data[1] = 25; // In Progress  
            data[2] = 10;  // Not Started
        }

        new Chart(completionCtx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.5)',
                        'rgba(255, 206, 86, 0.5)',
                        'rgba(255, 99, 132, 0.5)'
                    ],
                    borderColor: [
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }
}

// Auto-refresh every 30 seconds
setInterval(refreshCourseCount, 30000);
setInterval(refreshStudentCount, 30000);
setInterval(refreshAssignmentCount, 30000);
setInterval(refreshClassCount, 30000);

// Student Enrollment Dynamic Functionality
let currentPage = 1;
let totalPages = 1;
let currentSearch = '';
let currentOnlyManagers = false; // Default: show students only

// Initialize student enrollment on page load
document.addEventListener('DOMContentLoaded', function() {
    // Don't auto-load since we have initial data from server
    // loadStudentEnrollment();
    
    // Add search functionality
    const searchInput = document.getElementById('student-search');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentSearch = this.value;
                currentPage = 1;
                loadStudentEnrollment();
            }, 500);
        });
    }
});

function loadStudentEnrollment() {
    const loading = document.getElementById('enrollment-loading');
    const tableBody = document.getElementById('student-table-body');
    const noDataMessage = document.getElementById('no-students-message');
    const pagination = document.getElementById('enrollment-pagination');
    
    console.log('Loading student enrollment...');
    
    // Show loading state
    loading.style.display = 'block';
    tableBody.innerHTML = '';
    noDataMessage.style.display = 'none';
    pagination.style.display = 'none';
    
    // Build URL with parameters
    const params = new URLSearchParams({
        page: currentPage,
        perpage: 10,
        q: currentSearch,
        onlymanagers: currentOnlyManagers ? 1 : 0
    });
    
    const url = `{{config.wwwroot}}/theme/remui_kids/ajax/teacher_students.php?${params}`;
    console.log('Fetching URL:', url);
    
    fetch(url)
        .then(response => {
            console.log('Response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Received data:', data);
            loading.style.display = 'none';
            
            if (data.error) {
                console.error('Error loading students:', data.message);
                showNoDataMessage('Error loading students. Please try again.');
                return;
            }
            
            totalPages = data.pages || 1;
            currentPage = data.page || 1;
            
            if (data.students && data.students.length > 0) {
                console.log('Rendering students:', data.students);
                renderStudentTable(data.students);
                updatePagination(data);
            } else {
                console.log('No students found');
                showNoDataMessage();
            }
        })
        .catch(error => {
            loading.style.display = 'none';
            console.error('Fetch error:', error);
            showNoDataMessage('Error loading students. Please try again.');
        });
}

function renderStudentTable(students) {
    const tableBody = document.getElementById('student-table-body');
    const noDataMessage = document.getElementById('no-students-message');
    
    tableBody.innerHTML = '';
    noDataMessage.style.display = 'none';
    
    students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="avatar-col">
                <div class="student-avatar">
                    <img src="${student.avatar_url}" alt="${student.name}" onerror="this.style.display='none'">
                </div>
            </td>
            <td>
                <div class="student-info">
                    <div class="student-name">${student.name}</div>
                    <div class="student-email">${student.email}</div>
                </div>
            </td>
            <td>
                <div class="last-access">
                    <span class="access-time">${student.last_access}</span>
                </div>
            </td>
            <td>
                <div class="course-count">
                    <span class="badge badge-primary">${student.course_count}</span>
                </div>
            </td>
            <td class="actions-col">
                <a href="${student.profile_url}" class="btn btn-outline-primary btn-sm" title="View Profile">
                    <i class="fa fa-eye"></i>
                </a>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

function updatePagination(data) {
    const pagination = document.getElementById('enrollment-pagination');
    const paginationInfo = document.getElementById('pagination-info-text');
    const pageNumbers = document.getElementById('page-numbers');
    const prevButton = document.getElementById('prev-page');
    const nextButton = document.getElementById('next-page');
    
    if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
    }
    
    pagination.style.display = 'flex';
    
    // Update pagination info
    const start = ((currentPage - 1) * 10) + 1;
    const end = Math.min(currentPage * 10, data.total);
    paginationInfo.textContent = `Showing ${start}-${end} of ${data.total} students`;
    
    // Update page numbers
    pageNumbers.innerHTML = '';
    const maxVisiblePages = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
    
    if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }
    
    for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-secondary'}`;
        pageButton.textContent = i;
        pageButton.onclick = () => goToPage(i);
        pageNumbers.appendChild(pageButton);
    }
    
    // Update navigation buttons
    prevButton.disabled = currentPage <= 1;
    nextButton.disabled = currentPage >= totalPages;
}

function goToPage(page) {
    if (page >= 1 && page <= totalPages && page !== currentPage) {
        currentPage = page;
        loadStudentEnrollment();
    }
}

function changePage(direction) {
    const newPage = currentPage + direction;
    if (newPage >= 1 && newPage <= totalPages) {
        goToPage(newPage);
    }
}

function filterStudents() {
    const onlyManagersToggle = document.getElementById('only-managers-toggle');
    currentOnlyManagers = onlyManagersToggle.checked;
    currentPage = 1;
    loadStudentEnrollment();
}

function refreshStudentEnrollment() {
    loadStudentEnrollment();
}

// New button functions
function addNewStudent() {
    // Redirect to user creation page or open modal
    window.location.href = '{{config.wwwroot}}/user/editadvanced.php?id=-1';
}

function manageStudents() {
    // Redirect to user management page
    window.location.href = '{{config.wwwroot}}/admin/user.php';
}

// Questions System Functions
function refreshQuestions() {
    // Refresh questions data
    console.log('Refreshing questions...');
    // Add AJAX call to refresh questions
}

function viewAllQuestions() {
    // Redirect to unified questions page
    window.location.href = '{{config.wwwroot}}/theme/remui_kids/pages/questions_unified.php';
}

function createNewQuestion() {
    // Redirect to unified questions page with create tab
    window.location.href = '{{config.wwwroot}}/theme/remui_kids/pages/questions_unified.php?tab=create';
}

function filterQuestions() {
    const sortBy = document.getElementById('question-sort').value;
    const filter = document.getElementById('question-filter').value;
    
    console.log('Filtering questions:', { sortBy, filter });
    
    // Filter and sort questions
    const questionItems = document.querySelectorAll('.question-item');
    questionItems.forEach(item => {
        const grade = item.dataset.grade;
        const course = item.dataset.course;
        
        let show = true;
        
        if (filter !== 'all') {
            if (filter.startsWith('grade_')) {
                const filterGrade = filter.replace('grade_', 'Grade ');
                show = grade === filterGrade;
            } else {
                show = course.toLowerCase().includes(filter.toLowerCase());
            }
        }
        
        item.style.display = show ? 'block' : 'none';
    });
}

function answerQuestion(questionId) {
    // Open answer modal or redirect to answer page
    console.log('Answering question:', questionId);
    window.location.href = `{{config.wwwroot}}/theme/remui_kids/pages/answer_question.php?id=${questionId}`;
}

function startVideoCall(questionId) {
    // Start video call with student
    console.log('Starting video call for question:', questionId);
    // Implement video call functionality
    alert('Video call feature will be implemented');
}

function startAudioCall(questionId) {
    // Start audio call with student
    console.log('Starting audio call for question:', questionId);
    // Implement audio call functionality
    alert('Audio call feature will be implemented');
}

function startChat(questionId) {
    // Start chat with student
    console.log('Starting chat for question:', questionId);
    // Implement chat functionality
    window.location.href = `{{config.wwwroot}}/theme/remui_kids/pages/chat.php?question=${questionId}`;
}

function groupCall(questionId) {
    // Start group call for similar questions
    console.log('Starting group call for question:', questionId);
    // Implement group call functionality
    alert('Group call feature will be implemented');
}

// Moodle Integration Functions
function openMoodleMessaging() {
    // Navigate within the same tab
    window.location.href = '{{config.wwwroot}}/message/index.php';
}

function openMoodleForums() {
    // Navigate within the same tab
    window.location.href = '{{config.wwwroot}}/mod/forum/index.php';
}

function refreshIntegratedQuestions() {
    // Refresh questions from Moodle messaging and forums
    console.log('Refreshing integrated questions...');
    
    fetch('{{config.wwwroot}}/theme/remui_kids/ajax/student_questions.php?action=get_questions', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('Loaded', data.questions.length, 'integrated questions');
            // Update the questions list with new data
            updateQuestionsList(data.questions);
        } else {
            console.error('Failed to load integrated questions:', data.message);
        }
    })
    .catch(error => {
        console.error('Error loading integrated questions:', error);
    });
}

function updateQuestionsList(questions) {
    // Update the questions list with new data from Moodle
    const questionsList = document.querySelector('.questions-list');
    if (!questionsList) return;
    
    // Clear existing questions
    questionsList.innerHTML = '';
    
    if (questions.length === 0) {
        questionsList.innerHTML = `
            <div class="empty-state">
                <i class="fa fa-question-circle"></i>
                <p>No questions available from Moodle systems</p>
            </div>
        `;
        return;
    }
    
    // Add new questions
    questions.forEach(question => {
        const questionElement = createQuestionElement(question);
        questionsList.appendChild(questionElement);
    });
}

function createQuestionElement(question) {
    const div = document.createElement('div');
    div.className = 'question-item';
    div.setAttribute('data-grade', question.grade || 'All Grades');
    div.setAttribute('data-course', question.course_name || 'General');
    
    const statusClass = question.status === 'MENTOR REPLIED' ? 'mentor-replied' : 
                      question.status === 'Clarified' ? 'clarified' : 'pending';
    
    div.innerHTML = `
        <div class="question-header">
            <h4 class="question-title">${question.title}</h4>
            <div class="question-meta">
                <span class="question-grade">${question.grade || 'All Grades'}</span>
                <span class="question-course">${question.course_name || 'General'}</span>
            </div>
        </div>
        <div class="question-content">
            <p class="question-text">${question.content}</p>
            <div class="question-student">
                <span class="student-name">${question.student_name}</span>
                <span class="question-date">${new Date(question.timestamp * 1000).toLocaleDateString()}</span>
            </div>
        </div>
        <div class="question-status">
            <span class="status-badge ${statusClass}">${question.status}</span>
            <div class="question-stats">
                <span class="upvotes">${question.upvotes || 0} UPVOTES</span>
                <span class="replies">${question.replies || 0} REPLIES</span>
            </div>
        </div>
        <div class="question-actions">
            <button class="btn-action" onclick="answerQuestion('${question.id}')" title="Answer">
                <i class="fa fa-reply"></i>
            </button>
            <button class="btn-action" onclick="startVideoCall('${question.id}')" title="Video Call">
                <i class="fa fa-video"></i>
            </button>
            <button class="btn-action" onclick="startAudioCall('${question.id}')" title="Audio Call">
                <i class="fa fa-phone"></i>
            </button>
            <button class="btn-action" onclick="startChat('${question.id}')" title="Chat">
                <i class="fa fa-comments"></i>
            </button>
            <button class="btn-action" onclick="groupCall('${question.id}')" title="Group Call">
                <i class="fa fa-users"></i>
            </button>
        </div>
    `;
    
    return div;
}

function refreshCharts() {
    // Reinitialize charts with fresh data
    // Charts removed - now using real activity feed and course overview
    // initializeCharts();
}

function showNoDataMessage(message = null) {
    const tableBody = document.getElementById('student-table-body');
    const noDataMessage = document.getElementById('no-students-message');
    const pagination = document.getElementById('enrollment-pagination');
    const messageText = document.getElementById('no-data-message-text');
    
    tableBody.innerHTML = '';
    pagination.style.display = 'none';
    noDataMessage.style.display = 'block';
    
    if (message) {
        messageText.textContent = message;
    } else if (currentOnlyManagers) {
        messageText.textContent = 'No managers found in your courses.';
    } else {
        messageText.textContent = 'No students found. Enroll students in your courses to see them here.';
    }
}
</script>
