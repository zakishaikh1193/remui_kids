{{!
    Admin Dashboard Template for remui_kids theme
    
    This template provides a management dashboard interface for admin users
    with real-time insights and analytics for the educational platform.
}}

{{> theme_remui_kids/common_start}}

<style>
/* Force course categories height limit with scrollbar */
.course-categories-section .categories-list {
    max-height: 280px !important;
    overflow-y: auto !important;
    padding-right: 8px;
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
    border: 1px solid #e0e0e0;
}

.course-categories-section .categories-list::-webkit-scrollbar {
    width: 6px;
}

.course-categories-section .categories-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.course-categories-section .categories-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.course-categories-section .categories-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Force student enrollments height limit with scrollbar */
.admin-student-enrollments-section .enrollments-list {
    max-height: 240px !important;
    overflow-y: auto !important;
    padding-right: 8px;
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
}

.admin-student-enrollments-section .enrollments-list::-webkit-scrollbar {
    width: 6px;
}

.admin-student-enrollments-section .enrollments-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.admin-student-enrollments-section .enrollments-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.admin-student-enrollments-section .enrollments-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
</style>

{{#admin_dashboard}}
<!-- Full Screen Admin Dashboard Wrapper -->
<div class="admin-dashboard-wrapper">
    <!-- Mobile Sidebar Toggle Button -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fa fa-bars"></i>
    </button>

<!-- Admin Dashboard Header -->
<div class="admin-dashboard-header">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="admin-dashboard-title mb-2">
                    Management Dashboard
                </h1>
                <p class="admin-dashboard-subtitle mb-0">
                    Real-time insights and analytics for your educational platform
                </p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="admin-dashboard-badge">
                    <i class="fa fa-cog"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Admin Sidebar Navigation -->
<div class="admin-sidebar">
    <div class="sidebar-content">
        <!-- DASHBOARD Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">DASHBOARD</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/my/" class="sidebar-link">
                        <i class="fa fa-th-large sidebar-icon"></i>
                        <span class="sidebar-text">Admin Dashboard</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/admin/search.php" class="sidebar-link">
                        <i class="fa fa-cog sidebar-icon"></i>
                        <span class="sidebar-text">Site Administration</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-users sidebar-icon"></i>
                        <span class="sidebar-text">Community</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/admin/enrollments.php" class="sidebar-link">
                        <i class="fa fa-graduation-cap sidebar-icon"></i>
                        <span class="sidebar-text">Enrollments</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- TEACHERS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">TEACHERS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/admin/teachers_list.php" class="sidebar-link">
                        <i class="fa fa-users sidebar-icon"></i>
                        <span class="sidebar-text">Teachers</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-medal sidebar-icon"></i>
                        <span class="sidebar-text">Master Trainers</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- COURSES & PROGRAMS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">COURSES & PROGRAMS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/admin/courses.php" class="sidebar-link">
                        <i class="fa fa-book sidebar-icon"></i>
                        <span class="sidebar-text">Courses & Programs</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-graduation-cap sidebar-icon"></i>
                        <span class="sidebar-text">Certifications</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-clipboard-list sidebar-icon"></i>
                        <span class="sidebar-text">Assessments</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-school sidebar-icon"></i>
                        <span class="sidebar-text">Schools</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- INSIGHTS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">INSIGHTS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/local/edwiserreports/index.php" class="sidebar-link">
                        <i class="fa fa-chart-bar sidebar-icon"></i>
                        <span class="sidebar-text">Analytics</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-chart-line sidebar-icon"></i>
                        <span class="sidebar-text">Predictive Models</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-file-alt sidebar-icon"></i>
                        <span class="sidebar-text">Reports</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-map sidebar-icon"></i>
                        <span class="sidebar-text">Competencies Map</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- SETTINGS Section -->
        <div class="sidebar-section">
            <h3 class="sidebar-category">SETTINGS</h3>
            <ul class="sidebar-menu">
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/admin/user_profile_management.php" class="sidebar-link">
                        <i class="fa fa-cog sidebar-icon"></i>
                        <span class="sidebar-text">System Settings</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="{{config.wwwroot}}/theme/remui_kids/admin/users_management_dashboard.php" class="sidebar-link">
                        <i class="fa fa-user-friends sidebar-icon"></i>
                        <span class="sidebar-text">User Management</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="#" class="sidebar-link">
                        <i class="fa fa-users-cog sidebar-icon"></i>
                        <span class="sidebar-text">Cohort Navigation</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>


<!-- Main Content Area with Sidebar -->
<div class="admin-main-content">

<!-- Management Dashboard Statistics -->
<div class="admin-dashboard-stats">
    <div class="stats-section-container">
        <div class="section-header">
            <h3 class="section-title">Dashboard </h3>
            <p class="section-subtitle">Key performance indicators and platform metrics</p>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="admin-stats-container">
                    {{#admin_stats}}
                    <!-- Total Schools Card -->
                    <div class="admin-stat-card schools-card" id="schools-card">

                        <div class="stat-icon-container">
                            <i class="fa fa-building stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-schools-count">{{total_schools}}</div>
                            <div class="stat-label">TOTAL SCHOOLS</div>
                            <div class="stat-status">• Active</div>
                            <div class="stat-updated" id="schools-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{#admin_stats}}{{#last_updated}}{{last_updated}}{{/last_updated}}{{/admin_stats}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshSchoolCount()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="schools-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Total Courses Card -->
                    <div class="admin-stat-card courses-card" id="courses-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-book stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-courses-count">{{total_courses}}</div>
                            <div class="stat-label">TOTAL COURSES</div>
                            <div class="stat-status">• Available</div>
                            <div class="stat-updated" id="courses-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{#admin_stats}}{{#last_updated}}{{last_updated}}{{/last_updated}}{{/admin_stats}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshCourseCountAdmin()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="courses-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Total Students Card -->
                    <div class="admin-stat-card students-card" id="students-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-users stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="total-students-count">{{total_students}}</div>
                            <div class="stat-label">TOTAL STUDENTS</div>
                            <div class="stat-status">• Enrolled</div>
                            <div class="stat-updated" id="students-updated" style="font-size: 10px; color: #666; margin-top: 5px;">
                                Last updated: {{#admin_stats}}{{#last_updated}}{{last_updated}}{{/last_updated}}{{/admin_stats}}
                            </div>
                        </div>
                        <div class="stat-refresh-btn" onclick="refreshStudentCountAdmin()" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">
                            <i class="fa fa-refresh" id="students-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <!-- Average Course Rating Card -->
                    <div class="admin-stat-card rating-card">
                        <div class="stat-icon-container">
                            <i class="fa fa-star stat-icon"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{avg_course_rating}}/5</div>
                            <div class="stat-label">AVG COURSE RATING</div>
                            <div class="stat-status">• Excellent</div>
                        </div>
                    </div>
                    {{/admin_stats}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Statistics Section -->
<div class="admin-user-stats-section">
    <div class="stats-section-container">
        <div class="section-header">
            <h3 class="section-title">User Statistics</h3>
            
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="user-stats-container">
                    {{#admin_user_stats}}
                    <div class="user-stat-card total-users" id="total-users-card">
                        <div class="stat-number" id="total-users-count">{{total_users}}</div>
                        <div class="stat-label">Total Users</div>
                        <div class="stat-refresh-btn" onclick="refreshAllStats()" style="position: absolute; top: 5px; right: 5px; cursor: pointer; color: #666; font-size: 12px;" title="Refresh All Stats">
                            <i class="fa fa-refresh" id="all-stats-refresh-icon"></i>
                        </div>
                    </div>
                    
                    <div class="user-stat-card teachers" id="teachers-card">
                        <div class="stat-number" id="teachers-count">{{teachers}}</div>
                        <div class="stat-label">Teachers</div>
                    </div>
                    
                    <div class="user-stat-card students" id="students-card">
                        <div class="stat-number" id="students-count">{{students}}</div>
                        <div class="stat-label">Students</div>
                    </div>
                    
                    <div class="user-stat-card admins" id="admins-card">
                        <div class="stat-number" id="admins-count">{{admins}}</div>
                        <div class="stat-label">Admins</div>
                    </div>
                    
                    <div class="user-stat-card active-users" id="active-users-card">
                        <div class="stat-number" id="active-users-count">{{active_users}}</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    
                    <div class="user-stat-card new-users" id="new-users-card">
                        <div class="stat-number" id="new-users-count">{{new_this_month}}</div>

                        <div class="stat-label">New This Month</div>
                    </div>
                    {{/admin_user_stats}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Course Statistics and Recent Activity Section -->
<div class="admin-stats-activity-container">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Column: Course Statistics -->
            <div class="col-md-6">
                <div class="admin-course-stats-section">
                {{#admin_course_stats}}
                    <div class="stats-section-container">
                        <div class="section-header">
                            <h3 class="section-title">Course Statistics</h3>
                            
                        </div>
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="course-stats-grid">
                                        <!-- Total Courses Card -->
                                        <div class="course-stat-card total-courses">
                                            <div class="stat-content">
                                                <div class="stat-label">Total Courses</div>
                                                <div class="stat-number">{{total_courses}}</div>
                                            </div>
                                            <div class="stat-icon-container">
                                                <i class="fa fa-book stat-icon"></i>
                                            </div>
                                        </div>
                                        
                                        <!-- Completion Rate Card -->
                                        <div class="course-stat-card completion-rate">
                                            <div class="stat-content">
                                                <div class="stat-label">Completion Rate</div>
                                                <div class="stat-number">0%</div>
                                            </div>
                                            <div class="stat-icon-container">
                                                <i class="fa fa-bullseye stat-icon"></i>
                                            </div>
                                        </div>
                                        
                                        <!-- Average Rating Card -->
                                        <div class="course-stat-card avg-rating">
                                            <div class="stat-content">
                                                <div class="stat-label">Avg Rating</div>
                                                <div class="stat-number">0/5</div>
                                            </div>
                                            <div class="stat-icon-container">
                                                <i class="fa fa-star stat-icon"></i>
                                            </div>
                                        </div>
                                        
                                        <!-- Categories Card -->
                                        <div class="course-stat-card categories">
                                            <div class="stat-content">
                                                <div class="stat-label">Categories</div>
                                                <div class="stat-number">{{categories}}</div>
                                            </div>
                                            <div class="stat-icon-container">
                                                <i class="fa fa-building stat-icon"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Course Categories Section -->
                        <div class="course-categories-section">
                            <div class="subsection-header">
                                <h4 class="subsection-title">Course Categories</h4>
                                <a class="view-all-btn" href="{{config.wwwroot}}/theme/remui_kids/admin/manage_course_content.php">
                                    <span class="btn-glow"></span>
                                    <i class="fa fa-arrow-right"></i>
                                    View All
                                </a>
                            </div>
                            <div class="categories-list">
                                {{#admin_course_categories}}
                                <div class="category-item">
                                    <div class="category-left">
                                        <div class="category-name">{{name}}</div>
                                        <div class="category-enrollments">{{enrollment_count}} enrollments</div>
                                    </div>
                                    <div class="category-right">
                                        <div class="category-courses">{{course_count}} courses</div>
                                        <div class="category-completion">{{completion_rate}}% completion</div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{completion_rate}}%"></div>
                                    </div>
                                </div>
                                {{/admin_course_categories}}
                                
                                {{^admin_course_categories}}
                                <div class="category-item">
                                    <div class="category-left">
                                        <div class="category-name">No categories found</div>
                                        <div class="category-enrollments">0 enrollments</div>
                                    </div>
                                    <div class="category-right">
                                        <div class="category-courses">0 courses</div>
                                        <div class="category-completion">0% completion</div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                {{/admin_course_categories}}
                            </div>
                        </div>
                    </div>
                    {{/admin_course_stats}}
                </div>
            </div>
            
            <!-- Right Column: Recent Activity -->
            <div class="col-md-6">
                <div class="admin-recent-activity-section">
                    <div class="stats-section-container">
                        <div class="section-header">
                            <h3 class="section-title">Recent Activity</h3>
                            
                        </div>
                        <div class="recent-activity-container">
                            <!-- Course Completion -->
                            <div class="activity-item">
                                <div class="activity-icon purple">
                                    <i class="fa fa-check"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Course Completion</div>
                                    <div class="activity-description">9 teachers completed "Advanced Teaching Methods"</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">9/23/2025</span>
                                        <span class="activity-author">Fatima ki</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Teacher Certified -->
                            <div class="activity-item">
                                <div class="activity-icon purple">
                                    <i class="fa fa-graduation-cap"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Teacher Certified</div>
                                    <div class="activity-description">za ki received Master Trainer certification</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">9/23/2025</span>
                                        <span class="activity-author">za ki</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- New School Added -->
                            <div class="activity-item">
                                <div class="activity-icon purple">
                                    <i class="fa fa-building"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">New School Added</div>
                                    <div class="activity-description">Al-Huda-Global-School joined the platform</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">9/23/2025</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- New Course Created -->
                            <div class="activity-item">
                                <div class="activity-icon purple">
                                    <i class="fa fa-book"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">New Course Created</div>
                                    <div class="activity-description">"Digital Learning Fundamentals" course published</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">9/23/2025</span>
                                        <span class="activity-author">shak zaki</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Course Completion -->
                            <div class="activity-item">
                                <div class="activity-icon purple">
                                    <i class="fa fa-check"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Course Completion</div>
                                    <div class="activity-description">8 teachers completed "Advanced Teaching Methods"</div>
                                    <div class="activity-meta">
                                        <span class="activity-time">9/22/2025</span>
                                        <span class="activity-author">za ki</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Student Enrollments Section -->
<div class="admin-student-enrollments-section">
    <div class="container-fluid">
        <div class="student-enrollments-container">
        <div class="section-header">
            <div class="section-header-left">
                <h3 class="section-title">Student Enrollments</h3>
                <p class="section-subtitle">Real-time enrollment data from Moodle API</p>
            </div>
            <div class="section-header-right">
                
                <a class="view-all-btn" href="{{config.wwwroot}}/theme/remui_kids/admin/enrollments.php">
                    <span class="btn-glow"></span>
                    <i class="fa fa-arrow-right"></i>
                    View All
                </a>
            </div>
        </div>
            
            <div class="recent-enrollments-section">
                <div class="subsection-header">
                    <h4 class="subsection-title">Recent Student Enrollments</h4>
                </div>
                
                <div class="enrollments-list">
                    {{#student_enrollments}}
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">{{name}}</div>
                                <div class="user-role">Role: {{role}}</div>
                                {{#activity_level}}
                                <div class="activity-level">
                                    <div class="activity-bar">
                                        <div class="activity-fill" style="width: {{percentage}}%"></div>
                                    </div>
                                    <span class="activity-score">{{level}}/5</span>
                                </div>
                                {{/activity_level}}
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot {{status_class}}"></span>
                                <span class="status-text">{{status}}</span>
                            </div>
                            <div class="user-stats">{{logins}} logins • {{courses}} courses</div>
                        </div>
                    </div>
                    {{/student_enrollments}}
                    
                    {{^student_enrollments}}
                    <!-- Default Student Enrollments Matching Image -->
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">Guest user</div>
                                <div class="user-role">Role: student</div>
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot inactive"></span>
                                <span class="status-text">Inactive</span>
                            </div>
                            <div class="user-stats">0 logins • 0 courses</div>
                        </div>
                    </div>
                    
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">Kodeit Admin</div>
                                <div class="user-role">Role: school_admin</div>
                                <div class="activity-level">
                                    <div class="activity-bar">
                                        <div class="activity-fill" style="width: 80%"></div>
                                    </div>
                                    <span class="activity-score">1/5</span>
                                </div>
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot active"></span>
                                <span class="status-text">Active</span>
                            </div>
                            <div class="user-stats">29 logins • 0 courses</div>
                        </div>
                    </div>
                    
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">alhuda admin</div>
                                <div class="user-role">Role: school_admin</div>
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot inactive"></span>
                                <span class="status-text">Inactive</span>
                            </div>
                            <div class="user-stats">0 logins • 0 courses</div>
                        </div>
                    </div>
                    
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">James Walker</div>
                                <div class="user-role">Role: student</div>
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot inactive"></span>
                                <span class="status-text">Inactive</span>
                            </div>
                            <div class="user-stats">0 logins • 0 courses</div>
                        </div>
                    </div>
                    
                    <div class="enrollment-item">
                        <div class="user-info">
                            <div class="user-icon">
                                <i class="fa fa-users"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">Sophia Turner</div>
                                <div class="user-role">Role: student</div>
                            </div>
                        </div>
                        <div class="enrollment-status">
                            <div class="status-indicator">
                                <span class="status-dot inactive"></span>
                                <span class="status-text">Inactive</span>
                            </div>
                            <div class="user-stats">0 logins • 0 courses</div>
                        </div>
                    </div>
                    {{/student_enrollments}}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Student Activities Section -->
<div class="admin-student-activities-section">
        <div class="container-fluid">
        <div class="student-activities-container">
            <div class="section-header">
                <h3 class="section-title">Student Activities (Last 30 Days)</h3>
                <p class="section-subtitle">Detailed student activity tracking and engagement metrics</p>
                <div class="live-indicator">
                    <span class="live-dot blue"></span>
                    <span class="live-text">Live Activity Data</span>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="activities-summary-cards">
                {{#admin_student_activity_stats}}
                <div class="summary-card total-students">
                    <div class="card-icon">
                        <i class="fa fa-users"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number">{{total_students}}</div>
                        <div class="card-label">Total Students</div>
                    </div>
                </div>
                
                <div class="summary-card active-students">
                    <div class="card-icon">
                        <i class="fa fa-user-check"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number">{{active_students}}</div>
                        <div class="card-label">Active Students</div>
                    </div>
                </div>
                
                <div class="summary-card avg-activity">
                    <div class="card-icon">
                        <i class="fa fa-chart-line"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-number">{{avg_activity_level}}</div>
                        <div class="card-label">Avg Activity Level</div>
                    </div>
                </div>
                {{/admin_student_activity_stats}}
            </div>
            
            <!-- All Student Activities Section -->
            <div class="all-activities-section">
                <div class="subsection-header">
                    <h4 class="subsection-title">All Student Activities (Last 30 Days)</h4>
                    <button class="realtime-data-btn">Real-time data</button>
                </div>
                
                <div class="activities-scrollable-list">
                    {{#student_activities}}
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="header-item">
                                <i class="fa fa-calendar"></i>
                                <span>Last active: {{last_active}}</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-eye"></i>
                                <span>Engagement: {{engagement}}</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-book"></i>
                                <span>Courses: {{courses}}</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-clock"></i>
                                <span>Logins: {{logins}}</span>
                            </div>
                        </div>
                        
                        <div class="student-details">
                            <div class="student-info">
                                <div class="student-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="student-content">
                                    <div class="student-name">{{name}}</div>
                                    <div class="student-stats">
                                        <span class="stat-item">
                                            <i class="fa fa-clock"></i>
                                            {{logins}} logins
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-book"></i>
                                            {{courses}} courses
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-bullseye"></i>
                                            Level {{level}}/5
                                        </span>
                                    </div>
                                    <div class="activity-level-section">
                                        <div class="activity-level-label">Activity Level</div>
                                        <div class="activity-level-bar">
                                            <div class="activity-level-fill" style="width: {{activity_percentage}}%"></div>
                                        </div>
                                        <div class="activity-level-score">{{level}}/5</div>
                                    </div>
                                </div>
                            </div>
                            <div class="student-status">
                                <div class="status-indicator">
                                    <span class="status-dot {{status_class}}"></span>
                                    <span class="status-text">{{status}}</span>
                                </div>
                                <div class="last-seen">{{last_seen}}</div>
                            </div>
                        </div>
                    </div>
                    {{/student_activities}}
                    
                    {{^student_activities}}
                    <!-- Default Student Activities Matching Image -->
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="header-item">
                                <i class="fa fa-calendar"></i>
                                <span>Last active: Recently</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-eye"></i>
                                <span>Engagement: Low</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-book"></i>
                                <span>Courses: 0</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-clock"></i>
                                <span>Logins: 0</span>
                            </div>
                        </div>
                        
                        <div class="student-details">
                            <div class="student-info">
                                <div class="student-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="student-content">
                                    <div class="student-name">James Walker</div>
                                    <div class="student-stats">
                                        <span class="stat-item">
                                            <i class="fa fa-clock"></i>
                                            0 logins
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-book"></i>
                                            0 courses
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-bullseye"></i>
                                            Level 0/5
                                        </span>
                                    </div>
                                    <div class="activity-level-section">
                                        <div class="activity-level-label">Activity Level</div>
                                        <div class="activity-level-bar">
                                            <div class="activity-level-fill" style="width: 0%"></div>
                                        </div>
                                        <div class="activity-level-score">0/5</div>
                                    </div>
                                </div>
                            </div>
                            <div class="student-status">
                                <div class="status-indicator">
                                    <span class="status-dot inactive"></span>
                                    <span class="status-text">Inactive</span>
                                </div>
                                <div class="last-seen">Last seen recently</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="header-item">
                                <i class="fa fa-calendar"></i>
                                <span>Last active: Recently</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-eye"></i>
                                <span>Engagement: Low</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-book"></i>
                                <span>Courses: 0</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-clock"></i>
                                <span>Logins: 0</span>
                            </div>
                        </div>
                        
                        <div class="student-details">
                            <div class="student-info">
                                <div class="student-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="student-content">
                                    <div class="student-name">Sophia Turner</div>
                                    <div class="student-stats">
                                        <span class="stat-item">
                                            <i class="fa fa-clock"></i>
                                            0 logins
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-book"></i>
                                            0 courses
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-bullseye"></i>
                                            Level 0/5
                                        </span>
                                    </div>
                                    <div class="activity-level-section">
                                        <div class="activity-level-label">Activity Level</div>
                                        <div class="activity-level-bar">
                                            <div class="activity-level-fill" style="width: 0%"></div>
                                        </div>
                                        <div class="activity-level-score">0/5</div>
                                    </div>
                                </div>
                            </div>
                            <div class="student-status">
                                <div class="status-indicator">
                                    <span class="status-dot inactive"></span>
                                    <span class="status-text">Inactive</span>
                                </div>
                                <div class="last-seen">Last seen recently</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional sample cards for scrolling demonstration -->
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="header-item">
                                <i class="fa fa-calendar"></i>
                                <span>Last active: Recently</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-eye"></i>
                                <span>Engagement: Low</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-book"></i>
                                <span>Courses: 0</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-clock"></i>
                                <span>Logins: 0</span>
                            </div>
                        </div>
                        
                        <div class="student-details">
                            <div class="student-info">
                                <div class="student-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="student-content">
                                    <div class="student-name">Alex Johnson</div>
                                    <div class="student-stats">
                                        <span class="stat-item">
                                            <i class="fa fa-clock"></i>
                                            0 logins
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-book"></i>
                                            0 courses
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-bullseye"></i>
                                            Level 0/5
                                        </span>
                                    </div>
                                    <div class="activity-level-section">
                                        <div class="activity-level-label">Activity Level</div>
                                        <div class="activity-level-bar">
                                            <div class="activity-level-fill" style="width: 0%"></div>
                                        </div>
                                        <div class="activity-level-score">0/5</div>
                                    </div>
                                </div>
                            </div>
                            <div class="student-status">
                                <div class="status-indicator">
                                    <span class="status-dot inactive"></span>
                                    <span class="status-text">Inactive</span>
                                </div>
                                <div class="last-seen">Last seen recently</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="header-item">
                                <i class="fa fa-calendar"></i>
                                <span>Last active: Recently</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-eye"></i>
                                <span>Engagement: Low</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-book"></i>
                                <span>Courses: 0</span>
                            </div>
                            <div class="header-item">
                                <i class="fa fa-clock"></i>
                                <span>Logins: 0</span>
                            </div>
                        </div>
                        
                        <div class="student-details">
                            <div class="student-info">
                                <div class="student-icon">
                                    <i class="fa fa-users"></i>
                                </div>
                                <div class="student-content">
                                    <div class="student-name">Emma Davis</div>
                                    <div class="student-stats">
                                        <span class="stat-item">
                                            <i class="fa fa-clock"></i>
                                            0 logins
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-book"></i>
                                            0 courses
                                        </span>
                                        <span class="stat-item">
                                            <i class="fa fa-bullseye"></i>
                                            Level 0/5
                                        </span>
                                    </div>
                                    <div class="activity-level-section">
                                        <div class="activity-level-label">Activity Level</div>
                                        <div class="activity-level-bar">
                                            <div class="activity-level-fill" style="width: 0%"></div>
                                        </div>
                                        <div class="activity-level-score">0/5</div>
                                    </div>
                                </div>
                            </div>
                            <div class="student-status">
                                <div class="status-indicator">
                                    <span class="status-dot inactive"></span>
                                    <span class="status-text">Inactive</span>
                                </div>
                                <div class="last-seen">Last seen recently</div>
                            </div>
                        </div>
                    </div>
                    {{/student_activities}}
                </div>
            </div>
            
            <!-- Bottom Summary Bar -->
            <div class="bottom-summary-bar">
                <div class="summary-stats">
                    {{#admin_student_activity_stats}}
                    <span class="summary-stat">{{active_students}} Active Students</span>
                    <span class="summary-stat">{{avg_activity_level}} Avg Activity Level</span>
                    <span class="summary-stat">0 Total Course Access</span>
                    <span class="summary-stat">0 Total Logins</span>
                    {{/admin_student_activity_stats}}
                </div>
                <div class="floating-action-btn">
                    <i class="fa fa-plus"></i>
                </div>
            </div>
        </div>
    </div>
</div>

</div> <!-- End admin-main-content -->

{{/admin_dashboard}}

<!-- Regular Dashboard Content (fallback) -->
<div class="dashboard-content">
    <div id="region-main-box" class="d-print-block">
        <section id="region-main" class="d-print-block" aria-label="{{#str}}content{{/str}}">
            <div class="rui-course-content">
                {{{ output.main_content }}}
            </div>
        </section>
    </div>
</div>

{{> theme_remui/common_end}}

{{#js}}
// JavaScript modules are now loaded directly via lib.php
// No AMD require calls needed
{{/js}}

<script>
function toggleSidebar() {
    const sidebar = document.querySelector('.admin-sidebar');
    sidebar.classList.toggle('sidebar-open');
}

// Close sidebar when clicking outside on mobile
document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.admin-sidebar');
    const toggleButton = document.querySelector('.sidebar-toggle');
    
    if (window.innerWidth <= 768) {
        if (!sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
            sidebar.classList.remove('sidebar-open');
        }
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    const sidebar = document.querySelector('.admin-sidebar');
    if (window.innerWidth > 768) {
        sidebar.classList.remove('sidebar-open');
    }
});

// Highlight active sidebar menu item based on current URL
document.addEventListener('DOMContentLoaded', function() {
    const currentUrl = window.location.href;
    const currentPath = window.location.pathname;
    const sidebarItems = document.querySelectorAll('.sidebar-item');
    
    // Remove all active classes first
    sidebarItems.forEach(item => {
        item.classList.remove('active');
    });
    
    // Find and highlight the matching menu item
    sidebarItems.forEach(item => {
        const link = item.querySelector('.sidebar-link');
        if (link) {
            const href = link.getAttribute('href');
            
            // Skip empty or hash-only links
            if (!href || href === '#') {
                return;
            }
            
            // Check if current URL matches this link
            if (currentUrl === href || currentUrl.includes(href)) {
                item.classList.add('active');
            } else {
                // Try matching just the filename
                const linkPath = href.split('/').pop().split('?')[0];
                const currentFile = currentPath.split('/').pop().split('?')[0];
                
                if (linkPath && currentFile && linkPath === currentFile) {
                    item.classList.add('active');
                }
            }
        }
    });
    
    // If no item is active and we're on /my/ page, activate Admin Dashboard
    const hasActive = document.querySelector('.sidebar-item.active');
    if (!hasActive && (currentPath.includes('/my/') || currentPath.endsWith('/my'))) {
        const dashboardItem = document.querySelector('.sidebar-item a[href*="/my/"]');
        if (dashboardItem) {
            dashboardItem.closest('.sidebar-item').classList.add('active');
        }
    }
});

// Real-time statistics update functions
function refreshSchoolCount() {
    const refreshIcon = document.getElementById('schools-refresh-icon');
    const schoolsCount = document.getElementById('total-schools-count');
    const schoolsUpdated = document.getElementById('schools-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Fetch real-time data
    fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP ' + response.status);
            }
            return response.text(); // Get as text first
        })
        .then(text => {
            try {
                const data = JSON.parse(text);
                if (data.status === 'success') {
                    // Update the count with animation
                    animateCountUpdate(schoolsCount, data.total_schools);
                    schoolsUpdated.textContent = 'Last updated: ' + data.timestamp;
                    
                    // Show success feedback
                    showUpdateFeedback('schools-card', 'success');
                } else {
                    console.error('API Error:', data);
                    showUpdateFeedback('schools-card', 'error');
                }
            } catch (parseError) {
                console.error('JSON Parse Error:', parseError);
                console.error('Response text:', text);
                showUpdateFeedback('schools-card', 'error');
            }
        })
        .catch(error => {
            console.error('Fetch Error:', error);
            showUpdateFeedback('schools-card', 'error');
        })
        .finally(() => {
            // Remove loading state
            refreshIcon.classList.remove('fa-spin');
        });
}

// Course count refresh function for admin dashboard
function refreshCourseCountAdmin() {
    const refreshIcon = document.getElementById('courses-refresh-icon');
    const coursesCount = document.getElementById('total-courses-count');
    const coursesUpdated = document.getElementById('courses-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Fetch real-time data
    fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP ' + response.status);
            }
            return response.text(); // Get as text first
        })
        .then(text => {
            try {
                const data = JSON.parse(text);
                if (data.status === 'success') {
                    // Update the count with animation
                    animateCountUpdate(coursesCount, data.total_courses);
                    coursesUpdated.textContent = 'Last updated: ' + data.timestamp;
                    
                    // Show success feedback
                    showUpdateFeedback('courses-card', 'success');
                } else {
                    console.error('API Error:', data);
                    showUpdateFeedback('courses-card', 'error');
                }
            } catch (parseError) {
                console.error('JSON Parse Error:', parseError);
                console.error('Response text:', text);
                showUpdateFeedback('courses-card', 'error');
            }
        })
        .catch(error => {
            console.error('Fetch Error:', error);
            showUpdateFeedback('courses-card', 'error');
        })
        .finally(() => {
            // Remove loading state
            refreshIcon.classList.remove('fa-spin');
        });
}

function animateCountUpdate(element, newValue) {
    const currentValue = parseInt(element.textContent) || 0;
    const increment = newValue > currentValue ? 1 : -1;
    const duration = 1000; // 1 second
    const steps = Math.abs(newValue - currentValue);
    const stepDuration = duration / steps;
    
    let currentStep = 0;
    const timer = setInterval(() => {
        currentStep++;
        const newDisplayValue = currentValue + (increment * currentStep);
        element.textContent = newDisplayValue;
        
        if (currentStep >= steps) {
            clearInterval(timer);
            element.textContent = newValue;
        }
    }, stepDuration);
}

function showUpdateFeedback(cardId, type) {
    const card = document.getElementById(cardId);
    const feedback = document.createElement('div');
    feedback.className = `update-feedback ${type}`;
    feedback.textContent = type === 'success' ? '✓ Updated' : '✗ Error';
    feedback.style.cssText = `
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: ${type === 'success' ? '#4CAF50' : '#f44336'};
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
    `;
    
    card.style.position = 'relative';
    card.appendChild(feedback);
    
    // Fade in
    setTimeout(() => feedback.style.opacity = '1', 10);
    
    // Fade out and remove
    setTimeout(() => {
        feedback.style.opacity = '0';
        setTimeout(() => card.removeChild(feedback), 300);
    }, 2000);
}

// Student count refresh function for admin dashboard
function refreshStudentCountAdmin() {
    const refreshIcon = document.getElementById('students-refresh-icon');
    const studentsCount = document.getElementById('total-students-count');
    const studentsUpdated = document.getElementById('students-updated');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Fetch real-time data
    fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP ' + response.status);
            }
            return response.text(); // Get as text first
        })
        .then(text => {
            try {
                const data = JSON.parse(text);
                if (data.status === 'success') {
                    // Update the count with animation
                    animateCountUpdate(studentsCount, data.total_students);
                    studentsUpdated.textContent = 'Last updated: ' + data.timestamp;
                    
                    // Show success feedback
                    showUpdateFeedback('students-card', 'success');
                } else {
                    console.error('API Error:', data);
                    showUpdateFeedback('students-card', 'error');
                }
            } catch (parseError) {
                console.error('JSON Parse Error:', parseError);
                console.error('Response text:', text);
                showUpdateFeedback('students-card', 'error');
            }
        })
        .catch(error => {
            console.error('Fetch Error:', error);
            showUpdateFeedback('students-card', 'error');
        })
        .finally(() => {
            // Remove loading state
            refreshIcon.classList.remove('fa-spin');
        });
}

// Refresh all stats function
function refreshAllStats() {
    const refreshIcon = document.getElementById('all-stats-refresh-icon');
    
    // Show loading state
    refreshIcon.classList.add('fa-spin');
    
    // Fetch real-time data
    fetch('{{config.wwwroot}}/theme/remui_kids/tests/test_ajax.php')
        .then(response => {
            if (!response.ok) {
                throw new Error('HTTP ' + response.status);
            }
            return response.text();
        })
        .then(text => {
            try {
                const data = JSON.parse(text);
                if (data.status === 'success') {
                    // Update all counts with animation
                    animateCountUpdate(document.getElementById('total-schools-count'), data.total_schools);
                    animateCountUpdate(document.getElementById('total-courses-count'), data.total_courses);
                    animateCountUpdate(document.getElementById('total-students-count'), data.total_students);
                    animateCountUpdate(document.getElementById('total-users-count'), data.total_users);
                    animateCountUpdate(document.getElementById('teachers-count'), data.teachers);
                    animateCountUpdate(document.getElementById('students-count'), data.total_students);
                    animateCountUpdate(document.getElementById('admins-count'), data.admins);
                    animateCountUpdate(document.getElementById('active-users-count'), data.active_users);
                    animateCountUpdate(document.getElementById('new-users-count'), data.new_this_month);
                    
                    // Update timestamps
                    const timestamp = data.timestamp;
                    const timestampElements = document.querySelectorAll('[id$="-updated"]');
                    timestampElements.forEach(element => {
                        element.textContent = 'Last updated: ' + timestamp;
                    });
                    
                    // Show success feedback
                    showUpdateFeedback('total-users-card', 'success');
                } else {
                    console.error('API Error:', data);
                    showUpdateFeedback('total-users-card', 'error');
                }
            } catch (parseError) {
                console.error('JSON Parse Error:', parseError);
                console.error('Response text:', text);
                showUpdateFeedback('total-users-card', 'error');
            }
        })
        .catch(error => {
            console.error('Fetch Error:', error);
            showUpdateFeedback('total-users-card', 'error');
        })
        .finally(() => {
            // Remove loading state
            refreshIcon.classList.remove('fa-spin');
        });
}

// Auto-refresh every 30 seconds
setInterval(refreshSchoolCount, 30000);
setInterval(refreshCourseCountAdmin, 30000);
setInterval(refreshStudentCountAdmin, 30000);
setInterval(refreshAllStats, 30000);
</script>
</div> <!-- End admin-dashboard-wrapper -->
